import{_ as P,u as q,r as g,J as z,o as F,ai as I,Q as y,b as i,d as f,e as V,f as o,i as a,ah as J,w as l,j as d,t as r,l as L,h as Q,aj as R}from"./index-dc0220d7.js";const G={class:"subscription-orders-page"},H={class:"card"},W={class:"filter-bar"},X={class:"subscription-info"},Y={key:0},Z={class:"plan-name"},ee={class:"plan-detail"},te={style:{"margin-left":"10px"}},ae={key:1,class:"text-secondary"},le={class:"text-secondary text-small"},ne={class:"pagination"},se={__name:"SubscriptionOrders",setup(oe){const S=q(),x=g([]),k=g(0),p=z({keyword:"",status:null,is_subscription:1,page:1,per_page:15}),m=g(!1),h=g(!1),s=z({id:null,status:3,shipping_company:"",shipping_no:""});F(()=>{_()});const _=async()=>{try{const n=await I(p);x.value=n.data.data.data||[],k.value=n.data.data.total||0}catch{y.error("获取订单列表失败")}},O=n=>({0:"warning",1:"primary",3:"success",4:"info"})[n]||"info",U=n=>({0:"待支付",1:"待发货",3:"已完成",4:"已取消"})[n]||"未知",D=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",N=n=>{S.push({name:"AdminOrderDetail",params:{id:n}})},B=n=>{s.id=n.id,s.shipping_company="",s.shipping_no="",m.value=!0},T=async()=>{if(!s.shipping_company||!s.shipping_no){y.warning("请填写完整的物流信息");return}h.value=!0;try{await R(s.id,{status:3,shipping_company:s.shipping_company,shipping_no:s.shipping_no}),y.success("发货成功"),m.value=!1,_()}catch{y.error("发货失败")}finally{h.value=!1}};return(n,t)=>{const b=i("el-input"),v=i("el-option"),$=i("el-select"),c=i("el-button"),w=i("el-tag"),u=i("el-table-column"),j=i("el-table"),A=i("el-pagination"),C=i("el-form-item"),E=i("el-form"),K=i("el-dialog");return f(),V("div",G,[t[14]||(t[14]=o("h1",{class:"page-title"},"订阅订单管理",-1)),o("div",H,[o("div",W,[a(b,{modelValue:p.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>p.keyword=e),placeholder:"搜索订单号/收货人",style:{width:"300px"},onKeyup:J(_,["enter"])},null,8,["modelValue"]),a($,{modelValue:p.status,"onUpdate:modelValue":t[1]||(t[1]=e=>p.status=e),placeholder:"订单状态",clearable:"",onChange:_,style:{width:"150px"}},{default:l(()=>[a(v,{label:"待发货",value:1}),a(v,{label:"已完成",value:3}),a(v,{label:"已取消",value:4})]),_:1},8,["modelValue"]),a(c,{type:"primary",onClick:_},{default:l(()=>[...t[8]||(t[8]=[d("搜索",-1)])]),_:1})]),a(j,{data:x.value,style:{width:"100%"}},{default:l(()=>[a(u,{label:"订单号",width:"200"},{default:l(({row:e})=>[o("div",null,r(e.order_no),1),a(w,{type:"warning",size:"small",style:{"margin-top":"5px"}},{default:l(()=>[...t[9]||(t[9]=[d(" 订阅订单 ",-1)])]),_:1})]),_:1}),a(u,{prop:"user.username",label:"用户",width:"120"}),a(u,{label:"订阅计划",width:"300"},{default:l(({row:e})=>[o("div",X,[e.subscription?(f(),V("div",Y,[o("div",Z,r(e.subscription.plan_name),1),o("div",ee,[o("span",null,r(e.subscription.plan_type==="monthly"?"月度":e.subscription.plan_type==="quarterly"?"季度":"年度"),1),o("span",te,r(e.subscription.bottles_per_delivery)+"瓶/次",1)])])):(f(),V("div",ae,"未关联订阅"))])]),_:1}),a(u,{prop:"pay_amount",label:"订单金额",width:"120"},{default:l(({row:e})=>[d("£"+r(e.pay_amount),1)]),_:1}),a(u,{label:"订单状态",width:"120"},{default:l(({row:e})=>[a(w,{type:O(e.status)},{default:l(()=>[d(r(U(e.status)),1)]),_:2},1032,["type"])]),_:1}),a(u,{label:"收货人",width:"150"},{default:l(({row:e})=>[o("div",null,r(e.shipping_name),1),o("div",le,r(e.shipping_phone),1)]),_:1}),a(u,{label:"下单时间",width:"180"},{default:l(({row:e})=>[d(r(D(e.created_at)),1)]),_:1}),a(u,{label:"操作",width:"200",fixed:"right"},{default:l(({row:e})=>[a(c,{link:"",type:"primary",size:"small",onClick:M=>N(e.id)},{default:l(()=>[...t[10]||(t[10]=[d("查看",-1)])]),_:1},8,["onClick"]),e.status===1?(f(),L(c,{key:0,link:"",type:"success",size:"small",onClick:M=>B(e)},{default:l(()=>[...t[11]||(t[11]=[d(" 发货 ",-1)])]),_:1},8,["onClick"])):Q("",!0)]),_:1})]),_:1},8,["data"]),o("div",ne,[a(A,{"current-page":p.page,"onUpdate:currentPage":t[2]||(t[2]=e=>p.page=e),"page-size":p.per_page,"onUpdate:pageSize":t[3]||(t[3]=e=>p.per_page=e),total:k.value,"page-sizes":[10,15,20,50],layout:"total, sizes, prev, pager, next",onCurrentChange:_,onSizeChange:_},null,8,["current-page","page-size","total"])])]),a(K,{modelValue:m.value,"onUpdate:modelValue":t[7]||(t[7]=e=>m.value=e),title:"订单发货",width:"500px"},{footer:l(()=>[a(c,{onClick:t[6]||(t[6]=e=>m.value=!1)},{default:l(()=>[...t[12]||(t[12]=[d("取消",-1)])]),_:1}),a(c,{type:"primary",loading:h.value,onClick:T},{default:l(()=>[...t[13]||(t[13]=[d("确认发货",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(E,{model:s,"label-width":"120px"},{default:l(()=>[a(C,{label:"物流公司"},{default:l(()=>[a(b,{modelValue:s.shipping_company,"onUpdate:modelValue":t[4]||(t[4]=e=>s.shipping_company=e),placeholder:"如：顺丰快递"},null,8,["modelValue"])]),_:1}),a(C,{label:"物流单号"},{default:l(()=>[a(b,{modelValue:s.shipping_no,"onUpdate:modelValue":t[5]||(t[5]=e=>s.shipping_no=e),placeholder:"请输入物流单号"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},pe=P(se,[["__scopeId","data-v-2b96af14"]]);export{pe as default};
