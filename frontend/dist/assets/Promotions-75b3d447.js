import{_ as O,r as f,J as P,o as Q,z as h,Q as g,b as n,d as x,e as q,f as v,i as t,ah as G,w as o,j as d,t as U,l as E,P as H}from"./index-dc0220d7.js";const L={class:"promotions-page"},R={class:"card"},W={class:"filter-bar"},X={class:"pagination"},Y={__name:"Promotions",setup(Z){const C=f([]),B=f(0),m=f(!1),b=f("添加促销活动"),k=f(!1),c=f(null),r=P({keyword:"",status:null,page:1,per_page:15}),l=P({name:"",discount_type:"percentage",discount_value:10,status:1});Q(()=>{p()});const p=async()=>{try{const s=localStorage.getItem("admin_token"),e=await h.get("http://localhost:8000/api/admin/promotions",{params:r,headers:{Authorization:`Bearer ${s}`}});C.value=e.data.data.data||[],B.value=e.data.data.total||0}catch{g.error("获取促销活动列表失败")}},I=()=>{b.value="添加促销活动",c.value=null,$(),m.value=!0},S=s=>{b.value="编辑促销活动",c.value=s.id,Object.keys(l).forEach(e=>{s[e]!==void 0&&(l[e]=s[e])}),m.value=!0},A=async()=>{var s,e;if(!l.name){g.warning("请输入活动名称");return}k.value=!0;try{const i=localStorage.getItem("admin_token"),u=c.value?`http://localhost:8000/api/admin/promotions/${c.value}`:"http://localhost:8000/api/admin/promotions",V=c.value?"put":"post";await h[V](u,l,{headers:{Authorization:`Bearer ${i}`}}),g.success(c.value?"更新成功":"添加成功"),m.value=!1,p()}catch(i){g.error(((e=(s=i.response)==null?void 0:s.data)==null?void 0:e.message)||"操作失败")}finally{k.value=!1}},T=async s=>{var e,i;try{await H.confirm("确定要删除这个促销活动吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const u=localStorage.getItem("admin_token");await h.delete(`http://localhost:8000/api/admin/promotions/${s}`,{headers:{Authorization:`Bearer ${u}`}}),g.success("删除成功"),p()}catch(u){u!=="cancel"&&g.error(((i=(e=u.response)==null?void 0:e.data)==null?void 0:i.message)||"删除失败")}},$=()=>{l.name="",l.discount_type="percentage",l.discount_value=10,l.status=1};return(s,e)=>{const i=n("el-input"),u=n("el-option"),V=n("el-select"),_=n("el-button"),y=n("el-table-column"),z=n("el-tag"),M=n("el-table"),N=n("el-pagination"),w=n("el-form-item"),j=n("el-input-number"),D=n("el-switch"),K=n("el-form"),F=n("el-dialog");return x(),q("div",L,[e[16]||(e[16]=v("h1",{class:"page-title"},"促销活动管理",-1)),v("div",R,[v("div",W,[t(i,{modelValue:r.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>r.keyword=a),placeholder:"搜索活动名称",style:{width:"300px"},onKeyup:G(p,["enter"])},null,8,["modelValue"]),t(V,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=a=>r.status=a),placeholder:"状态",clearable:"",onChange:p,style:{width:"150px"}},{default:o(()=>[t(u,{label:"启用",value:1}),t(u,{label:"禁用",value:0})]),_:1},8,["modelValue"]),t(_,{type:"primary",onClick:p},{default:o(()=>[...e[8]||(e[8]=[d("搜索",-1)])]),_:1}),t(_,{type:"success",onClick:I},{default:o(()=>[...e[9]||(e[9]=[d("添加活动",-1)])]),_:1})]),t(M,{data:C.value,style:{width:"100%"}},{default:o(()=>[t(y,{prop:"name",label:"活动名称",width:"200"}),t(y,{prop:"discount_value",label:"折扣值",width:"120"},{default:o(({row:a})=>[d(U(a.discount_value)+"% ",1)]),_:1}),t(y,{label:"状态",width:"100"},{default:o(({row:a})=>[t(z,{type:a.status===1?"success":"info"},{default:o(()=>[d(U(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(y,{label:"操作",width:"150",fixed:"right"},{default:o(({row:a})=>[t(_,{link:"",type:"primary",onClick:J=>S(a)},{default:o(()=>[...e[10]||(e[10]=[d("编辑",-1)])]),_:1},8,["onClick"]),a.id!==1?(x(),E(_,{key:0,link:"",type:"danger",onClick:J=>T(a.id)},{default:o(()=>[...e[11]||(e[11]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])):(x(),E(z,{key:1,size:"small",type:"info"},{default:o(()=>[...e[12]||(e[12]=[d("系统保留",-1)])]),_:1}))]),_:1})]),_:1},8,["data"]),v("div",X,[t(N,{"current-page":r.page,"onUpdate:currentPage":e[2]||(e[2]=a=>r.page=a),total:B.value,"page-size":r.per_page,layout:"total, prev, pager, next",onCurrentChange:p},null,8,["current-page","total","page-size"])])]),t(F,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),title:b.value,width:"600px",onClose:$},{footer:o(()=>[t(_,{onClick:e[6]||(e[6]=a=>m.value=!1)},{default:o(()=>[...e[14]||(e[14]=[d("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:A,loading:k.value},{default:o(()=>[...e[15]||(e[15]=[d("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(K,{model:l,"label-width":"140px"},{default:o(()=>[t(w,{label:"活动名称"},{default:o(()=>[t(i,{modelValue:l.name,"onUpdate:modelValue":e[3]||(e[3]=a=>l.name=a),placeholder:"如：首单折扣"},null,8,["modelValue"])]),_:1}),t(w,{label:"折扣值"},{default:o(()=>[t(j,{modelValue:l.discount_value,"onUpdate:modelValue":e[4]||(e[4]=a=>l.discount_value=a),min:0,max:100,precision:2},null,8,["modelValue"]),e[13]||(e[13]=v("span",{class:"tip"},"（百分比，如10表示10%折扣）",-1))]),_:1}),t(w,{label:"状态"},{default:o(()=>[t(D,{modelValue:l.status,"onUpdate:modelValue":e[5]||(e[5]=a=>l.status=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},te=O(Y,[["__scopeId","data-v-183024ac"]]);export{te as default};
