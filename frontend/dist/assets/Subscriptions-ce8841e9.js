import{_ as q,r as f,J,o as Q,Q as z,b as u,d as N,e as I,f as d,i as t,ah as A,w as a,j as o,t as l,h as F}from"./index-dc0220d7.js";import{a as G,b as H}from"./subscription-66f0ec92.js";const O={class:"subscriptions-page"},R={class:"card"},W={class:"filter-bar"},X={class:"text-secondary"},Y={class:"text-secondary"},Z={class:"text-small"},ee={class:"text-small"},te={class:"pagination"},ae={key:0,class:"subscription-detail"},le={__name:"Subscriptions",setup(se){const w=f([]),x=f(0),y=f(!1),i=f(null),c=J({keyword:"",status:"",page:1,per_page:15});Q(()=>{m()});const m=async()=>{try{const n=await G(c);w.value=n.data.data.data||[],x.value=n.data.data.total||0}catch{z.error("获取订阅列表失败")}},U=async n=>{try{const s=await H(n.id);i.value=s.data.data,y.value=!0}catch{z.error("获取订阅详情失败")}},S=n=>({active:"success",paused:"warning",cancelled:"info",past_due:"danger"})[n]||"info",V=n=>({active:"活跃",paused:"已暂停",cancelled:"已取消",past_due:"逾期"})[n]||n,k=n=>({monthly:"月",quarterly:"季",yearly:"年"})[n]||n,B=n=>({pending:"warning",shipped:"primary",delivered:"success",failed:"danger"})[n]||"info",P=n=>({pending:"待处理",shipped:"已发货",delivered:"已送达",failed:"失败"})[n]||n,b=n=>n?new Date(n).toLocaleDateString("zh-CN"):"-",g=n=>n?new Date(n).toLocaleString("zh-CN"):"-";return(n,s)=>{const $=u("el-input"),v=u("el-option"),E=u("el-select"),D=u("el-button"),r=u("el-table-column"),h=u("el-tag"),K=u("el-tooltip"),C=u("el-table"),L=u("el-pagination"),p=u("el-descriptions-item"),M=u("el-descriptions"),j=u("el-dialog");return N(),I("div",O,[s[8]||(s[8]=d("h1",{class:"page-title"},"订阅用户列表",-1)),d("div",R,[d("div",W,[t($,{modelValue:c.keyword,"onUpdate:modelValue":s[0]||(s[0]=e=>c.keyword=e),placeholder:"搜索用户名/邮箱",style:{width:"300px"},onKeyup:A(m,["enter"])},null,8,["modelValue"]),t(E,{modelValue:c.status,"onUpdate:modelValue":s[1]||(s[1]=e=>c.status=e),placeholder:"订阅状态",clearable:"",onChange:m,style:{width:"150px"}},{default:a(()=>[t(v,{label:"活跃",value:"active"}),t(v,{label:"已暂停",value:"paused"}),t(v,{label:"已取消",value:"cancelled"}),t(v,{label:"逾期",value:"past_due"})]),_:1},8,["modelValue"]),t(D,{type:"primary",onClick:m},{default:a(()=>[...s[4]||(s[4]=[o("搜索",-1)])]),_:1})]),t(C,{data:w.value,style:{width:"100%"}},{default:a(()=>[t(r,{label:"用户信息",width:"200"},{default:a(({row:e})=>{var _,T;return[d("div",null,[d("strong",null,l((_=e.user)==null?void 0:_.username),1)]),d("div",X,l((T=e.user)==null?void 0:T.email),1)]}),_:1}),t(r,{label:"订阅计划",width:"200"},{default:a(({row:e})=>[d("div",null,[d("strong",null,l(e.plan_name),1)]),d("div",Y,l(e.bottles_per_delivery)+"瓶/次",1)]),_:1}),t(r,{prop:"price",label:"价格",width:"100"},{default:a(({row:e})=>[o(" $"+l(e.price)+"/"+l(k(e.plan_type)),1)]),_:1}),t(r,{label:"状态",width:"100"},{default:a(({row:e})=>[t(h,{type:S(e.status)},{default:a(()=>[o(l(V(e.status)),1)]),_:2},1032,["type"])]),_:1}),t(r,{label:"下次发货",width:"120"},{default:a(({row:e})=>[o(l(b(e.next_delivery_date)),1)]),_:1}),t(r,{label:"当前周期",width:"200"},{default:a(({row:e})=>[d("div",Z,[o(l(b(e.current_period_start)),1),s[5]||(s[5]=d("br",null,null,-1)),o(" 至 "+l(b(e.current_period_end)),1)])]),_:1}),t(r,{label:"Stripe订阅ID",width:"180"},{default:a(({row:e})=>[t(K,{content:e.stripe_subscription_id,placement:"top"},{default:a(()=>{var _;return[d("span",ee,l((_=e.stripe_subscription_id)==null?void 0:_.substring(0,20))+"...",1)]}),_:2},1032,["content"])]),_:1}),t(r,{label:"订阅时间",width:"180"},{default:a(({row:e})=>[o(l(g(e.created_at)),1)]),_:1}),t(r,{label:"操作",width:"100",fixed:"right"},{default:a(({row:e})=>[t(D,{link:"",type:"primary",onClick:_=>U(e)},{default:a(()=>[...s[6]||(s[6]=[o("查看详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),d("div",te,[t(L,{"current-page":c.page,"onUpdate:currentPage":s[2]||(s[2]=e=>c.page=e),total:x.value,"page-size":c.per_page,layout:"total, prev, pager, next",onCurrentChange:m},null,8,["current-page","total","page-size"])])]),t(j,{modelValue:y.value,"onUpdate:modelValue":s[3]||(s[3]=e=>y.value=e),title:"订阅详情",width:"800px"},{default:a(()=>[i.value?(N(),I("div",ae,[t(M,{column:2,border:""},{default:a(()=>[t(p,{label:"用户"},{default:a(()=>{var e,_;return[o(l((e=i.value.user)==null?void 0:e.username)+" ("+l((_=i.value.user)==null?void 0:_.email)+") ",1)]}),_:1}),t(p,{label:"订阅计划"},{default:a(()=>[o(l(i.value.plan_name),1)]),_:1}),t(p,{label:"价格"},{default:a(()=>[o(" $"+l(i.value.price)+"/"+l(k(i.value.plan_type)),1)]),_:1}),t(p,{label:"配送瓶数"},{default:a(()=>[o(l(i.value.bottles_per_delivery)+"瓶/次 ",1)]),_:1}),t(p,{label:"订阅状态"},{default:a(()=>[t(h,{type:S(i.value.status)},{default:a(()=>[o(l(V(i.value.status)),1)]),_:1},8,["type"])]),_:1}),t(p,{label:"当前周期开始"},{default:a(()=>[o(l(b(i.value.current_period_start)),1)]),_:1}),t(p,{label:"当前周期结束"},{default:a(()=>[o(l(b(i.value.current_period_end)),1)]),_:1}),t(p,{label:"Stripe订阅ID",span:2},{default:a(()=>[o(l(i.value.stripe_subscription_id),1)]),_:1}),t(p,{label:"Stripe客户ID",span:2},{default:a(()=>[o(l(i.value.stripe_customer_id),1)]),_:1}),t(p,{label:"订阅时间",span:2},{default:a(()=>[o(l(g(i.value.created_at)),1)]),_:1})]),_:1}),s[7]||(s[7]=d("h3",{style:{"margin-top":"20px"}},"配送记录",-1)),t(C,{data:i.value.deliveries,style:{width:"100%"},size:"small"},{default:a(()=>[t(r,{label:"配送日期",width:"120"},{default:a(({row:e})=>[o(l(b(e.delivery_date)),1)]),_:1}),t(r,{label:"状态",width:"100"},{default:a(({row:e})=>[t(h,{type:B(e.status),size:"small"},{default:a(()=>[o(l(P(e.status)),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"tracking_company",label:"物流公司",width:"120"}),t(r,{prop:"tracking_number",label:"物流单号",width:"150"}),t(r,{label:"发货时间",width:"180"},{default:a(({row:e})=>[o(l(e.shipped_at?g(e.shipped_at):"-"),1)]),_:1}),t(r,{prop:"notes",label:"备注"})]),_:1},8,["data"])])):F("",!0)]),_:1},8,["modelValue"])])}}},ie=q(le,[["__scopeId","data-v-46675b3d"]]);export{ie as default};
