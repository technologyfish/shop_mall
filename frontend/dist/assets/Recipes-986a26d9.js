import{_ as X,r as g,J as q,o as Y,b as s,ab as Z,d as c,e as h,f as v,i as l,w as o,H as y,Q as f,k as V,R as ee,j as m,C as te,l as k,h as le,t as z,F as ae,g as oe,P as ie}from"./index-dc0220d7.js";import{g as E}from"./image-da0f5490.js";import{I as se}from"./ImageUpload-9701b259.js";import{R as ne}from"./RichTextEditor-60d7e47b.js";import{f as re}from"./format-d9fb0471.js";/* empty css                                                                    */const pe={class:"recipes-container"},de={class:"page-header"},ue={key:1,class:"text-muted"},me={__name:"Recipes",setup(ge){const x=g(!1),w=g(!1),R=g([]),B=g([]),d=q({page:1,limit:10,total:0}),_=g(!1),C=g("添加食谱"),D=g(null),a=q({id:null,category_id:null,title:"",subtitle:"",image:"",prep_time:10,cook_time:30,servings:4,content:""}),I={title:[{required:!0,message:"请输入标题",trigger:"blur"}],subtitle:[{required:!0,message:"请输入副标题",trigger:"blur"}],image:[{required:!0,message:"请上传封面图片",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},b=async()=>{var i,e;x.value=!0;try{const{data:n}=await y.get("/api/admin/recipes",{params:{page:d.page,limit:d.limit}});R.value=n.data.data||[],d.total=n.data.total||0}catch(n){f.error(((e=(i=n.response)==null?void 0:i.data)==null?void 0:e.message)||"获取食谱列表失败")}finally{x.value=!1}},T=()=>{C.value="添加食谱",Object.assign(a,{id:null,category_id:null,title:"",subtitle:"",image:"",prep_time:10,cook_time:30,servings:4,content:""}),_.value=!0},M=i=>{C.value="编辑食谱",Object.assign(a,{id:i.id,category_id:i.category_id,title:i.title,subtitle:i.subtitle,image:i.image,prep_time:i.prep_time||10,cook_time:i.cook_time,servings:i.servings,content:i.instructions||i.content||""}),_.value=!0},N=async()=>{var e,n;if(await D.value.validate().catch(()=>!1)){w.value=!0;try{const r={category_id:a.category_id,title:a.title,subtitle:a.subtitle,slug:a.title.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),image:a.image,description:a.subtitle,ingredients:`<p>准备时间：${a.prep_time}分钟</p>`,instructions:a.content,prep_time:a.prep_time,cook_time:a.cook_time,servings:a.servings,difficulty:"medium",is_featured:1,sort:100,status:1};a.id?(await y.put(`/api/admin/recipes/${a.id}`,r),f.success("更新成功")):(await y.post("/api/admin/recipes",r),f.success("添加成功")),_.value=!1,b()}catch(r){f.error(((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"操作失败")}finally{w.value=!1}}},S=i=>{ie.confirm("确定要删除这个食谱吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,n;try{await y.delete(`/api/admin/recipes/${i.id}`),f.success("删除成功"),b()}catch(r){f.error(((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"删除失败")}})},F=async()=>{try{const{data:i}=await y.get("/api/admin/recipe-categories",{params:{per_page:100}});B.value=i.data.data||[]}catch(i){console.error("获取分类列表失败",i)}};return Y(()=>{b(),F()}),(i,e)=>{const n=s("el-icon"),r=s("el-button"),p=s("el-table-column"),L=s("el-image"),O=s("el-tag"),P=s("el-table"),A=s("el-pagination"),H=s("el-card"),$=s("el-input"),u=s("el-form-item"),j=s("el-option"),J=s("el-select"),U=s("el-input-number"),Q=s("el-form"),G=s("el-dialog"),K=Z("loading");return c(),h("div",pe,[v("div",de,[e[13]||(e[13]=v("h2",null,"食谱管理",-1)),l(r,{type:"primary",onClick:T},{default:o(()=>[l(n,null,{default:o(()=>[l(V(ee))]),_:1}),e[12]||(e[12]=m(" 添加食谱 ",-1))]),_:1})]),l(H,{class:"table-card"},{default:o(()=>[te((c(),k(P,{data:R.value,border:"",stripe:""},{default:o(()=>[l(p,{prop:"id",label:"ID",width:"80"}),l(p,{prop:"image",label:"图片",width:"100"},{default:o(({row:t})=>[t.image?(c(),k(L,{key:0,src:V(E)(t.image),"preview-src-list":[V(E)(t.image)],fit:"cover",style:{width:"60px",height:"60px","border-radius":"4px"}},null,8,["src","preview-src-list"])):le("",!0)]),_:1}),l(p,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),l(p,{prop:"subtitle",label:"副标题","min-width":"200","show-overflow-tooltip":""}),l(p,{label:"分类",width:"120"},{default:o(({row:t})=>[t.category?(c(),k(O,{key:0},{default:o(()=>[m(z(t.category.name),1)]),_:2},1024)):(c(),h("span",ue,"未分类"))]),_:1}),l(p,{prop:"cook_time",label:"制作时间",width:"100"},{default:o(({row:t})=>[m(z(t.cook_time)+" 分钟 ",1)]),_:1}),l(p,{prop:"servings",label:"服务人数",width:"100"}),l(p,{prop:"created_at",label:"发布时间",width:"180"},{default:o(({row:t})=>[m(z(V(re)(t.created_at)),1)]),_:1}),l(p,{label:"操作",width:"180",fixed:"right"},{default:o(({row:t})=>[l(r,{size:"small",onClick:W=>M(t)},{default:o(()=>[...e[14]||(e[14]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"danger",onClick:W=>S(t)},{default:o(()=>[...e[15]||(e[15]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,x.value]]),l(A,{"current-page":d.page,"onUpdate:currentPage":e[0]||(e[0]=t=>d.page=t),"page-size":d.limit,"onUpdate:pageSize":e[1]||(e[1]=t=>d.limit=t),total:d.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])]),_:1}),l(G,{modelValue:_.value,"onUpdate:modelValue":e[11]||(e[11]=t=>_.value=t),title:C.value,width:"1000px","close-on-click-modal":!1},{footer:o(()=>[l(r,{onClick:e[10]||(e[10]=t=>_.value=!1)},{default:o(()=>[...e[19]||(e[19]=[m("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:N,loading:w.value},{default:o(()=>[...e[20]||(e[20]=[m(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(Q,{ref_key:"formRef",ref:D,model:a,rules:I,"label-width":"100px"},{default:o(()=>[l(u,{label:"标题",prop:"title"},{default:o(()=>[l($,{modelValue:a.title,"onUpdate:modelValue":e[2]||(e[2]=t=>a.title=t),placeholder:"请输入标题",style:{width:"60%"}},null,8,["modelValue"])]),_:1}),l(u,{label:"副标题",prop:"subtitle"},{default:o(()=>[l($,{modelValue:a.subtitle,"onUpdate:modelValue":e[3]||(e[3]=t=>a.subtitle=t),placeholder:"请输入副标题",style:{width:"60%"}},null,8,["modelValue"])]),_:1}),l(u,{label:"封面图片",prop:"image"},{default:o(()=>[l(se,{modelValue:a.image,"onUpdate:modelValue":e[4]||(e[4]=t=>a.image=t),tip:"建议尺寸：800x600，支持jpg、png、gif、webp，最大5MB"},null,8,["modelValue"])]),_:1}),l(u,{label:"分类",prop:"category_id"},{default:o(()=>[l(J,{modelValue:a.category_id,"onUpdate:modelValue":e[5]||(e[5]=t=>a.category_id=t),placeholder:"请选择分类",style:{width:"60%"}},{default:o(()=>[l(j,{label:"未分类",value:null}),(c(!0),h(ae,null,oe(B.value,t=>(c(),k(j,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"准备时间",prop:"prep_time"},{default:o(()=>[l(U,{modelValue:a.prep_time,"onUpdate:modelValue":e[6]||(e[6]=t=>a.prep_time=t),min:0,step:5,"controls-position":"right"},null,8,["modelValue"]),e[16]||(e[16]=v("span",{style:{"margin-left":"10px",color:"#909399"}},"分钟",-1))]),_:1}),l(u,{label:"制作时间",prop:"cook_time"},{default:o(()=>[l(U,{modelValue:a.cook_time,"onUpdate:modelValue":e[7]||(e[7]=t=>a.cook_time=t),min:0,step:5,"controls-position":"right"},null,8,["modelValue"]),e[17]||(e[17]=v("span",{style:{"margin-left":"10px",color:"#909399"}},"分钟",-1))]),_:1}),l(u,{label:"服务人数",prop:"servings"},{default:o(()=>[l(U,{modelValue:a.servings,"onUpdate:modelValue":e[8]||(e[8]=t=>a.servings=t),min:1,step:1,"controls-position":"right"},null,8,["modelValue"]),e[18]||(e[18]=v("span",{style:{"margin-left":"10px",color:"#909399"}},"人",-1))]),_:1}),l(u,{label:"内容",prop:"content"},{default:o(()=>[l(ne,{modelValue:a.content,"onUpdate:modelValue":e[9]||(e[9]=t=>a.content=t),placeholder:"请输入食谱的详细内容，包括食材、步骤等...",height:"600px"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ve=X(me,[["__scopeId","data-v-b2ff7238"]]);export{Ve as default};
