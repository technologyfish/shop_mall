import{_ as A,r as u,J,o as Q,b as n,ab as F,d as w,e as G,f as V,i as t,w as a,Q as p,k as x,R as H,j as f,C as K,l as U,h as L,P as W}from"./index-dc0220d7.js";import{g as h}from"./image-da0f5490.js";import{a as X,u as Y,c as Z,d as ee}from"./journey-40a7592c.js";import{I as te}from"./ImageUpload-9701b259.js";/* empty css                                                                    */const le={class:"journeys-container"},ae={class:"page-header"},oe={__name:"Journeys",setup(ne){const _=u(!1),v=u(!1),C=u([]),i=J({page:1,limit:10,total:0}),d=u(!1),b=u("添加记录"),k=u(null),o=J({id:null,year:"",title:"",description:"",image:"",sort:0}),z={year:[{required:!0,message:"请输入时间标签",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],image:[{required:!0,message:"请上传图片",trigger:"change"}]},m=async()=>{_.value=!0;try{const{data:r}=await X({page:i.page,limit:i.limit});C.value=r.data.data||[],i.total=r.data.total||0}catch{p.error("获取列表失败")}finally{_.value=!1}},B=()=>{b.value="添加记录",Object.assign(o,{id:null,year:"",title:"",description:"",image:"",sort:0}),d.value=!0},j=r=>{b.value="编辑记录",Object.assign(o,r),d.value=!0},I=async()=>{if(await k.value.validate().catch(()=>!1)){v.value=!0;try{o.id?(await Y(o.id,o),p.success("更新成功")):(await Z(o),p.success("添加成功")),d.value=!1,m()}catch{p.error("操作失败")}finally{v.value=!1}}},D=r=>{W.confirm("确定要删除这条记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ee(r.id),p.success("删除成功"),m()}catch{p.error("删除失败")}})};return Q(()=>{m()}),(r,e)=>{const E=n("el-icon"),c=n("el-button"),s=n("el-table-column"),N=n("el-image"),T=n("el-table"),q=n("el-pagination"),M=n("el-card"),y=n("el-input"),g=n("el-form-item"),O=n("el-input-number"),R=n("el-form"),S=n("el-dialog"),$=F("loading");return w(),G("div",le,[V("div",ae,[e[10]||(e[10]=V("h2",null,"Journey管理",-1)),t(c,{type:"primary",onClick:B},{default:a(()=>[t(E,null,{default:a(()=>[t(x(H))]),_:1}),e[9]||(e[9]=f(" 添加记录 ",-1))]),_:1})]),t(M,{class:"table-card"},{default:a(()=>[K((w(),U(T,{data:C.value,border:"",stripe:""},{default:a(()=>[t(s,{prop:"id",label:"ID",width:"80"}),t(s,{prop:"image",label:"图片",width:"120"},{default:a(({row:l})=>[l.image?(w(),U(N,{key:0,src:x(h)(l.image),"preview-src-list":[x(h)(l.image)],fit:"cover",style:{width:"80px",height:"60px","border-radius":"4px"}},null,8,["src","preview-src-list"])):L("",!0)]),_:1}),t(s,{prop:"year",label:"时间标签",width:"150",sortable:""}),t(s,{prop:"title",label:"标题","min-width":"150","show-overflow-tooltip":""}),t(s,{prop:"description",label:"描述","min-width":"250","show-overflow-tooltip":""}),t(s,{prop:"sort",label:"排序",width:"100",sortable:""}),t(s,{label:"操作",width:"180",fixed:"right"},{default:a(({row:l})=>[t(c,{size:"small",onClick:P=>j(l)},{default:a(()=>[...e[11]||(e[11]=[f("编辑",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:"danger",onClick:P=>D(l)},{default:a(()=>[...e[12]||(e[12]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,_.value]]),t(q,{"current-page":i.page,"onUpdate:currentPage":e[0]||(e[0]=l=>i.page=l),"page-size":i.limit,"onUpdate:pageSize":e[1]||(e[1]=l=>i.limit=l),total:i.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])]),_:1}),t(S,{modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=l=>d.value=l),title:b.value,width:"700px"},{footer:a(()=>[t(c,{onClick:e[7]||(e[7]=l=>d.value=!1)},{default:a(()=>[...e[14]||(e[14]=[f("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:I,loading:v.value},{default:a(()=>[...e[15]||(e[15]=[f(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(R,{ref_key:"formRef",ref:k,model:o,rules:z,"label-width":"100px"},{default:a(()=>[t(g,{label:"时间标签",prop:"year"},{default:a(()=>[t(y,{modelValue:o.year,"onUpdate:modelValue":e[2]||(e[2]=l=>o.year=l),placeholder:"如：Oct 2024"},null,8,["modelValue"])]),_:1}),t(g,{label:"标题",prop:"title"},{default:a(()=>[t(y,{modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=l=>o.title=l),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(g,{label:"描述",prop:"description"},{default:a(()=>[t(y,{modelValue:o.description,"onUpdate:modelValue":e[4]||(e[4]=l=>o.description=l),type:"textarea",rows:4,placeholder:"请输入描述内容"},null,8,["modelValue"])]),_:1}),t(g,{label:"图片",prop:"image"},{default:a(()=>[t(te,{modelValue:o.image,"onUpdate:modelValue":e[5]||(e[5]=l=>o.image=l),tip:"建议尺寸：600x400"},null,8,["modelValue"])]),_:1}),t(g,{label:"排序",prop:"sort"},{default:a(()=>[t(O,{modelValue:o.sort,"onUpdate:modelValue":e[6]||(e[6]=l=>o.sort=l),min:0,max:999,"controls-position":"right"},null,8,["modelValue"]),e[13]||(e[13]=V("span",{class:"form-tip"},"数字越大越靠前",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=A(oe,[["__scopeId","data-v-804bb6f1"]]);export{pe as default};
