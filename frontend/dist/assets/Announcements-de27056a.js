import{_ as W,r as v,J as C,o as X,b as i,ab as Y,d as A,e as Z,f as z,i as t,w as a,H as k,Q as m,k as j,R as ee,j as d,C as te,l as le,t as U,P as ae}from"./index-dc0220d7.js";import{f as ne}from"./format-d9fb0471.js";const oe={class:"announcements-container"},se={class:"page-header"},ue={__name:"Announcements",setup(ie){const V=v(!1),w=v(!1),B=v([]),r=C({keyword:"",status:null}),p=C({page:1,limit:10,total:0}),f=v(!1),x=v("添加公告"),S=v(null),o=C({id:null,content:"",link:"",sort:100,status:1}),E={content:[{required:!0,message:"请输入公告内容",trigger:"blur"},{min:1,max:500,message:"长度在 1 到 500 个字符",trigger:"blur"}]},b=async()=>{var n,e;V.value=!0;try{const{data:s}=await k.get("/api/admin/announcements",{params:{page:p.page,limit:p.limit,keyword:r.keyword||void 0,status:r.status!==null?r.status:void 0}});B.value=s.data.data||[],p.total=s.data.total||0}catch(s){m.error(((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.message)||"获取公告列表失败")}finally{V.value=!1}},y=()=>{p.page=1,b()},N=()=>{r.keyword="",r.status=null,y()},R=()=>{x.value="添加公告",Object.assign(o,{id:null,content:"",link:"",sort:100,status:1}),f.value=!0},M=n=>{x.value="编辑公告",Object.assign(o,{id:n.id,content:n.content,link:n.link,sort:n.sort,status:n.status}),f.value=!0},q=async()=>{var e,s;if(await S.value.validate().catch(()=>!1)){w.value=!0;try{o.id?(await k.put(`/api/admin/announcements/${o.id}`,o),m.success("更新成功")):(await k.post("/api/admin/announcements",o),m.success("添加成功")),f.value=!1,b()}catch(u){m.error(((s=(e=u.response)==null?void 0:e.data)==null?void 0:s.message)||"操作失败")}finally{w.value=!1}}},I=async n=>{var s,u;const e=Number(n.status)===1?0:1;try{await k.put(`/api/admin/announcements/${n.id}`,{content:n.content,link:n.link||"",sort:n.sort||100,status:e}),m.success("状态更新成功"),b()}catch(g){console.error("Toggle status error:",g),m.error(((u=(s=g.response)==null?void 0:s.data)==null?void 0:u.message)||"操作失败")}},O=n=>{ae.confirm("确定要删除这条公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,s;try{await k.delete(`/api/admin/announcements/${n.id}`),m.success("删除成功"),b()}catch(u){m.error(((s=(e=u.response)==null?void 0:e.data)==null?void 0:s.message)||"删除失败")}})};return X(()=>{b()}),(n,e)=>{const s=i("el-icon"),u=i("el-button"),g=i("el-input"),c=i("el-form-item"),$=i("el-option"),P=i("el-select"),h=i("el-form"),D=i("el-card"),_=i("el-table-column"),F=i("el-tag"),H=i("el-table"),J=i("el-pagination"),Q=i("el-input-number"),G=i("el-switch"),K=i("el-dialog"),L=Y("loading");return A(),Z("div",oe,[z("div",se,[e[11]||(e[11]=z("h2",null,"公告管理",-1)),t(u,{type:"primary",onClick:R},{default:a(()=>[t(s,null,{default:a(()=>[t(j(ee))]),_:1}),e[10]||(e[10]=d(" 添加公告 ",-1))]),_:1})]),t(D,{class:"search-card"},{default:a(()=>[t(h,{inline:!0,model:r},{default:a(()=>[t(c,{label:"关键词"},{default:a(()=>[t(g,{modelValue:r.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>r.keyword=l),placeholder:"搜索公告内容",clearable:"",onClear:y},null,8,["modelValue"])]),_:1}),t(c,{label:"状态"},{default:a(()=>[t(P,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=l=>r.status=l),placeholder:"全部",clearable:""},{default:a(()=>[t($,{label:"启用",value:1}),t($,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(u,{type:"primary",onClick:y},{default:a(()=>[...e[12]||(e[12]=[d("搜索",-1)])]),_:1}),t(u,{onClick:N},{default:a(()=>[...e[13]||(e[13]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"table-card"},{default:a(()=>[te((A(),le(H,{data:B.value,border:"",stripe:""},{default:a(()=>[t(_,{prop:"id",label:"ID",width:"80"}),t(_,{prop:"content",label:"公告内容","min-width":"300"}),t(_,{prop:"link",label:"链接",width:"150"}),t(_,{prop:"sort",label:"排序",width:"100",sortable:""}),t(_,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(F,{type:l.status===1?"success":"danger"},{default:a(()=>[d(U(l.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[d(U(j(ne)(l.created_at)),1)]),_:1}),t(_,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(u,{size:"small",onClick:T=>M(l)},{default:a(()=>[...e[14]||(e[14]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:l.status===1?"warning":"success",onClick:T=>I(l)},{default:a(()=>[d(U(l.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(u,{size:"small",type:"danger",onClick:T=>O(l)},{default:a(()=>[...e[15]||(e[15]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,V.value]]),t(J,{"current-page":p.page,"onUpdate:currentPage":e[2]||(e[2]=l=>p.page=l),"page-size":p.limit,"onUpdate:pageSize":e[3]||(e[3]=l=>p.limit=l),total:p.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1}),t(K,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=l=>f.value=l),title:x.value,width:"600px"},{footer:a(()=>[t(u,{onClick:e[8]||(e[8]=l=>f.value=!1)},{default:a(()=>[...e[17]||(e[17]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:q,loading:w.value},{default:a(()=>[...e[18]||(e[18]=[d(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(h,{ref_key:"formRef",ref:S,model:o,rules:E,"label-width":"100px"},{default:a(()=>[t(c,{label:"公告内容",prop:"content"},{default:a(()=>[t(g,{modelValue:o.content,"onUpdate:modelValue":e[4]||(e[4]=l=>o.content=l),type:"textarea",rows:4,placeholder:"请输入公告内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(c,{label:"链接",prop:"link"},{default:a(()=>[t(g,{modelValue:o.link,"onUpdate:modelValue":e[5]||(e[5]=l=>o.link=l),placeholder:"请输入链接地址（可选）"},null,8,["modelValue"])]),_:1}),t(c,{label:"排序",prop:"sort"},{default:a(()=>[t(Q,{modelValue:o.sort,"onUpdate:modelValue":e[6]||(e[6]=l=>o.sort=l),min:0,max:999,"controls-position":"right"},null,8,["modelValue"]),e[16]||(e[16]=z("span",{class:"form-tip"},"数字越大越靠前",-1))]),_:1}),t(c,{label:"状态",prop:"status"},{default:a(()=>[t(G,{modelValue:o.status,"onUpdate:modelValue":e[7]||(e[7]=l=>o.status=l),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=W(ue,[["__scopeId","data-v-7300c945"]]);export{pe as default};
