import{_ as G,u as H,a as W,r as f,o as X,c as p,b as y,d as i,e as c,f as s,k as I,i as _,w as C,l as q,h as b,F as Z,g as ee,t as r,K as h,P as A,j as x}from"./index-dc0220d7.js";import{g as te}from"./image-da0f5490.js";import{u as se,d as ae}from"./cart-5154d6d7.js";import{g as oe}from"./shipping-cb1b4a6b.js";const ne={class:"cart-page"},le={class:"container"},re={key:0,class:"cart-content"},ie={class:"cart-header"},ce={class:"cart-items"},ue=["src"],de={class:"product-info"},pe={class:"product-name"},ve={class:"product-price"},_e={class:"quantity-control"},he={class:"item-total"},me={class:"cart-footer"},ge={class:"footer-left"},fe={class:"footer-right"},ye={class:"price-summary"},Ce={class:"price-row"},xe={key:0,class:"price-row"},Se={key:1,class:"price-row"},ke={key:2,class:"price-row discount"},we={style:{color:"#67c23a"}},Fe={class:"price-row total"},Ie={class:"amount"},be={__name:"Cart",setup(De){const P=H(),l=se(),S=W(),a=f([]),v=f(null),k=f(!1),m=f(0);X(async()=>{var t,e;await l.fetchCart();try{const o=await oe();v.value=o.data.data}catch(o){console.error("Failed to load shipping settings:",o)}if(S.isLoggedIn&&(await S.fetchUserInfo(),((t=S.userInfo)==null?void 0:t.first_order_discount)===1))try{const d=await(await fetch("/api/off-code/promotion")).json();(e=d.data)!=null&&e.active&&(k.value=!0,m.value=d.data.discount_value||10)}catch(o){console.error("Failed to get promotion info:",o)}});const D=p({get(){return l.cartItems.length>0&&a.value.length===l.cartItems.length},set(t){}}),j=p(()=>a.value.length>0&&a.value.length<l.cartItems.length),u=p(()=>l.cartItems.filter(t=>a.value.includes(t.id)).reduce((t,e)=>{var o;return t+((o=e.product)==null?void 0:o.price)*e.quantity},0)),w=p(()=>{if(!v.value||u.value===0)return 0;const t=v.value;return!t.shipping_fee||parseFloat(t.shipping_fee)===0||t.free_shipping_threshold&&parseFloat(t.free_shipping_threshold)>0&&u.value>=parseFloat(t.free_shipping_threshold)?0:parseFloat(t.shipping_fee)}),F=p(()=>!k.value||m.value<=0?0:u.value*(m.value/100)),R=p(()=>u.value+w.value-F.value),E=t=>a.value.includes(t),L=t=>{t?a.value=l.cartItems.map(e=>e.id):a.value=[]},M=(t,e)=>{if(e)a.value.includes(t)||a.value.push(t);else{const o=a.value.indexOf(t);o>-1&&a.value.splice(o,1)}},$=async(t,e)=>{try{await l.updateItem(t.id,e)}catch(o){h.error(o.message||"Update failed"),l.fetchCart()}},z=async t=>{try{await A.confirm("Are you sure you want to delete this item?","Confirm",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}),await l.removeItem(t);const e=a.value.indexOf(t);e>-1&&a.value.splice(e,1)}catch(e){e!=="cancel"&&h.error(e.message||"Delete failed")}},J=async()=>{if(a.value.length===0){h.warning("Please select items to delete");return}try{await A.confirm(`Delete ${a.value.length} selected item(s)?`,"Confirm",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}),await ae(a.value),await l.fetchCart(),a.value=[]}catch(t){t!=="cancel"&&h.error(t.message||"Delete failed")}},K=()=>{if(a.value.length===0){h.warning("Please select items to checkout");return}localStorage.setItem("checkout_cart_ids",JSON.stringify(a.value)),P.push("/orders/create")};return(t,e)=>{const o=y("el-checkbox"),d=y("el-button"),Q=y("el-input-number"),Y=y("el-empty");return i(),c("div",ne,[s("div",le,[e[8]||(e[8]=s("h1",{class:"page-title"},"Shopping Cart",-1)),I(l).cartItems.length?(i(),c("div",re,[s("div",ie,[_(o,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=n=>D.value=n),onChange:L,indeterminate:j.value},{default:C(()=>[...e[1]||(e[1]=[x(" Select All ",-1)])]),_:1},8,["modelValue","indeterminate"]),a.value.length>0?(i(),q(d,{key:0,type:"danger",text:"",onClick:J},{default:C(()=>[x(" Delete Selected ("+r(a.value.length)+") ",1)]),_:1})):b("",!0)]),s("div",ce,[(i(!0),c(Z,null,ee(I(l).cartItems,n=>{var B,T,V,U,N,O;return i(),c("div",{key:n.id,class:"cart-item"},[_(o,{"model-value":E(n.id),onChange:g=>M(n.id,g)},null,8,["model-value","onChange"]),s("img",{src:I(te)(((B=n.product)==null?void 0:B.image)||((T=n.product)==null?void 0:T.main_image),"/placeholder-product.jpg"),class:"product-img"},null,8,ue),s("div",de,[s("div",pe,r((V=n.product)==null?void 0:V.name),1),s("div",ve,"£"+r((U=n.product)==null?void 0:U.price),1)]),s("div",_e,[_(Q,{"model-value":n.quantity,min:1,max:(N=n.product)==null?void 0:N.stock,onChange:g=>$(n,g)},null,8,["model-value","max","onChange"])]),s("div",he," £"+r((((O=n.product)==null?void 0:O.price)*n.quantity).toFixed(2)),1),_(d,{type:"danger",text:"",onClick:g=>z(n.id)},{default:C(()=>[...e[2]||(e[2]=[x(" Delete ",-1)])]),_:1},8,["onClick"])])}),128))]),s("div",me,[s("div",ge,[s("span",null,"Selected "+r(a.value.length)+" item(s)",1)]),s("div",fe,[s("div",ye,[s("div",Ce,[e[3]||(e[3]=s("span",{class:"sub-total"},"Subtotal:",-1)),s("span",null,"£"+r(u.value.toFixed(2)),1)]),w.value>0?(i(),c("div",xe,[e[4]||(e[4]=s("span",null,"Shipping:",-1)),s("span",null,"£"+r(w.value.toFixed(2)),1)])):v.value&&v.value.shipping_fee>0&&u.value>0?(i(),c("div",Se,[...e[5]||(e[5]=[s("span",null,"Shipping:",-1),s("span",{style:{color:"#67c23a"}},"Free",-1)])])):b("",!0),k.value&&F.value>0?(i(),c("div",ke,[s("span",null,"First Order Discount ("+r(m.value)+"%):",1),s("span",we,"-£"+r(F.value.toFixed(2)),1)])):b("",!0),s("div",Fe,[e[6]||(e[6]=s("span",null,"Total:",-1)),s("span",Ie,"£"+r(R.value.toFixed(2)),1)])]),_(d,{class:"btn-checkout",type:"primary",size:"large",onClick:K,disabled:a.value.length===0},{default:C(()=>[...e[7]||(e[7]=[x(" Checkout ",-1)])]),_:1},8,["disabled"])])])])):(i(),q(Y,{key:1,description:"Your cart is empty"}))])])}}},Ne=G(be,[["__scopeId","data-v-db1d2736"]]);export{Ne as default};
