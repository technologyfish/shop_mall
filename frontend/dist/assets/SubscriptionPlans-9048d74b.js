import{_ as L,a9 as X,r as b,J as z,o as Y,Q as u,b as n,d as g,e as I,f as v,i as l,ah as Z,w as s,j as i,t as x,l as C,k as T,R as ee,P as le}from"./index-dc0220d7.js";import{g as te,u as ae,c as oe,d as se}from"./subscription-66f0ec92.js";const ne={class:"subscription-plans-page"},ie={class:"card"},re={class:"filter-bar"},de={class:"pagination"},pe=["src"],ue="http://localhost:8000/api/admin/upload",me={__name:"SubscriptionPlans",setup(_e){const D=X(),P=b([]),U=b(0),f=b(!1),k=b("添加订阅计划"),w=b(!1),V=b(null),m=z({keyword:"",status:null,page:1,per_page:15}),a=z({name:"",description:"",image:"",price:29.99,plan_type:"monthly",bottles_per_delivery:3,stripe_price_id:"",sort:0,status:1}),E=o=>{o.code===200?(a.image=o.data.path,u.success("图片上传成功")):u.error(o.message||"图片上传失败")},M=o=>o?o.startsWith("http")?o:`https://www.aizhong168.cn${o}`:"";Y(()=>{c()});const c=async()=>{try{const o=await te(m);P.value=o.data.data.data||[],U.value=o.data.data.total||0}catch{u.error("获取计划列表失败")}},A=o=>({monthly:"月度",quarterly:"季度",yearly:"年度"})[o]||o,N=()=>{k.value="添加订阅计划",V.value=null,B(),f.value=!0},j=o=>{k.value="编辑订阅计划",V.value=o.id,a.image=o.image||"",Object.assign(a,{name:o.name,description:o.description,price:o.price,plan_type:o.plan_type,bottles_per_delivery:o.bottles_per_delivery,stripe_price_id:o.stripe_price_id,sort:o.sort,status:o.status}),f.value=!0},q=async()=>{var o,e;if(!a.name){u.warning("请输入计划名称");return}w.value=!0;try{V.value?(await ae(V.value,a),u.success("更新成功")):(await oe(a),u.success("添加成功")),f.value=!1,c()}catch(r){u.error(((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"操作失败")}finally{w.value=!1}},K=async o=>{var e,r;try{await le.confirm("确定要删除这个订阅计划吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await se(o),u.success("删除成功"),c()}catch(_){_!=="cancel"&&u.error(((r=(e=_.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败")}},B=()=>{a.name="",a.description="",a.image="",a.price=29.99,a.plan_type="monthly",a.bottles_per_delivery=3,a.stripe_price_id="",a.sort=0,a.status=1};return(o,e)=>{const r=n("el-input"),_=n("el-option"),$=n("el-select"),y=n("el-button"),d=n("el-table-column"),S=n("el-tag"),F=n("el-table"),J=n("el-pagination"),p=n("el-form-item"),O=n("el-icon"),Q=n("el-upload"),h=n("el-input-number"),R=n("el-switch"),W=n("el-form"),G=n("el-dialog");return g(),I("div",ne,[e[21]||(e[21]=v("h1",{class:"page-title"},"订阅计划管理",-1)),v("div",ie,[v("div",re,[l(r,{modelValue:m.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>m.keyword=t),placeholder:"搜索计划名称",style:{width:"300px"},onKeyup:Z(c,["enter"])},null,8,["modelValue"]),l($,{modelValue:m.status,"onUpdate:modelValue":e[1]||(e[1]=t=>m.status=t),placeholder:"状态",clearable:"",onChange:c,style:{width:"150px"}},{default:s(()=>[l(_,{label:"启用",value:1}),l(_,{label:"禁用",value:0})]),_:1},8,["modelValue"]),l(y,{type:"primary",onClick:c},{default:s(()=>[...e[13]||(e[13]=[i("搜索",-1)])]),_:1}),l(y,{type:"success",onClick:N},{default:s(()=>[...e[14]||(e[14]=[i("添加计划",-1)])]),_:1})]),l(F,{data:P.value,style:{width:"100%"}},{default:s(()=>[l(d,{prop:"name",label:"计划名称",width:"200"}),l(d,{prop:"description",label:"描述"}),l(d,{prop:"price",label:"价格",width:"100"},{default:s(({row:t})=>[i(" $"+x(t.price),1)]),_:1}),l(d,{prop:"plan_type",label:"周期",width:"100"},{default:s(({row:t})=>[i(x(A(t.plan_type)),1)]),_:1}),l(d,{prop:"bottles_per_delivery",label:"配送瓶数",width:"100"}),l(d,{prop:"stripe_price_id",label:"Stripe Price ID",width:"200"},{default:s(({row:t})=>[t.stripe_price_id?(g(),C(S,{key:0,type:"success",size:"small"},{default:s(()=>[i(x(t.stripe_price_id),1)]),_:2},1024)):(g(),C(S,{key:1,type:"danger",size:"small"},{default:s(()=>[...e[15]||(e[15]=[i("未配置",-1)])]),_:1}))]),_:1}),l(d,{label:"状态",width:"80"},{default:s(({row:t})=>[l(S,{type:t.status===1?"success":"info"},{default:s(()=>[i(x(t.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"sort",label:"排序",width:"80"}),l(d,{label:"操作",width:"150",fixed:"right"},{default:s(({row:t})=>[l(y,{link:"",type:"primary",onClick:H=>j(t)},{default:s(()=>[...e[16]||(e[16]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(y,{link:"",type:"danger",onClick:H=>K(t.id)},{default:s(()=>[...e[17]||(e[17]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),v("div",de,[l(J,{"current-page":m.page,"onUpdate:currentPage":e[2]||(e[2]=t=>m.page=t),total:U.value,"page-size":m.per_page,layout:"total, prev, pager, next",onCurrentChange:c},null,8,["current-page","total","page-size"])])]),l(G,{modelValue:f.value,"onUpdate:modelValue":e[12]||(e[12]=t=>f.value=t),title:k.value,width:"600px",onClose:B},{footer:s(()=>[l(y,{onClick:e[11]||(e[11]=t=>f.value=!1)},{default:s(()=>[...e[19]||(e[19]=[i("取消",-1)])]),_:1}),l(y,{type:"primary",onClick:q,loading:w.value},{default:s(()=>[...e[20]||(e[20]=[i("确定",-1)])]),_:1},8,["loading"])]),default:s(()=>[l(W,{model:a,"label-width":"120px"},{default:s(()=>[l(p,{label:"计划名称"},{default:s(()=>[l(r,{modelValue:a.name,"onUpdate:modelValue":e[3]||(e[3]=t=>a.name=t),placeholder:"如：3 Bottles Monthly"},null,8,["modelValue"])]),_:1}),l(p,{label:"计划描述"},{default:s(()=>[l(r,{modelValue:a.description,"onUpdate:modelValue":e[4]||(e[4]=t=>a.description=t),type:"textarea",rows:3,placeholder:"详细描述"},null,8,["modelValue"])]),_:1}),l(p,{label:"计划图片"},{default:s(()=>[l(Q,{class:"avatar-uploader",action:ue,headers:{Authorization:`Bearer ${T(D).token}`},"show-file-list":!1,"on-success":E,accept:"image/*"},{default:s(()=>[a.image?(g(),I("img",{key:0,src:M(a.image),class:"avatar"},null,8,pe)):(g(),C(O,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[l(T(ee))]),_:1}))]),_:1},8,["headers"])]),_:1}),l(p,{label:"价格"},{default:s(()=>[l(h,{modelValue:a.price,"onUpdate:modelValue":e[5]||(e[5]=t=>a.price=t),min:0,precision:2,step:.01},null,8,["modelValue"])]),_:1}),l(p,{label:"计划类型"},{default:s(()=>[l($,{modelValue:a.plan_type,"onUpdate:modelValue":e[6]||(e[6]=t=>a.plan_type=t),placeholder:"请选择"},{default:s(()=>[l(_,{label:"月度订阅",value:"monthly"}),l(_,{label:"季度订阅",value:"quarterly"}),l(_,{label:"年度订阅",value:"yearly"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"配送瓶数"},{default:s(()=>[l(h,{modelValue:a.bottles_per_delivery,"onUpdate:modelValue":e[7]||(e[7]=t=>a.bottles_per_delivery=t),min:1},null,8,["modelValue"])]),_:1}),l(p,{label:"Stripe Price ID"},{default:s(()=>[l(r,{modelValue:a.stripe_price_id,"onUpdate:modelValue":e[8]||(e[8]=t=>a.stripe_price_id=t),placeholder:"price_xxxxxxxxxxxxx"},null,8,["modelValue"]),e[18]||(e[18]=v("div",{class:"tip"},"在Stripe Dashboard创建产品后获取",-1))]),_:1}),l(p,{label:"排序"},{default:s(()=>[l(h,{modelValue:a.sort,"onUpdate:modelValue":e[9]||(e[9]=t=>a.sort=t),min:0},null,8,["modelValue"])]),_:1}),l(p,{label:"状态"},{default:s(()=>[l(R,{modelValue:a.status,"onUpdate:modelValue":e[10]||(e[10]=t=>a.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ye=L(me,[["__scopeId","data-v-d128b554"]]);export{ye as default};
