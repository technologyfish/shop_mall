import{_ as ce,r as _,J as q,c as ge,o as fe,b as u,ab as _e,d as b,e as h,f as C,i as t,w as a,H as x,Q as f,k as W,R as J,j as d,C as be,l as z,h as S,t as $,P as ve}from"./index-dc0220d7.js";/* empty css                                                                    */const ye={class:"products-container"},Ve={class:"page-header"},ke={key:0},we={key:1},xe={key:2,style:{color:"#999"}},Ue={class:"image-upload-container"},he={__name:"Products",setup(Ce){const L="https://www.aizhong168.cn",B=s=>s?s.startsWith("http")?s:`${L}${s}`:"",D=_(!1),I=_(!1),P=_([]),p=q({keyword:"",status:null,is_featured:null}),g=q({page:1,limit:10,total:0}),v=_(!1),R=_("添加商品"),T=_(null),n=q({id:null,name:"",slug:"",description:"",content:"",image:"",images:[],price:0,original_price:null,stock:100,sales:0,tags:[],is_featured:0,is_new:0,sort:100,status:1}),y=_([]),Q=ge(()=>`${L}/api/admin/upload`),G=_({Authorization:"Bearer "+localStorage.getItem("admin_token")}),K={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],slug:[{required:!0,message:"请输入Slug",trigger:"blur"}],image:[{required:!0,message:"请上传图片",trigger:"change"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}]},V=async()=>{var s,e;D.value=!0;try{const{data:o}=await x.get("/api/admin/products",{params:{page:g.page,limit:g.limit,keyword:p.keyword||void 0,status:p.status!==null?p.status:void 0,is_featured:p.is_featured!==null?p.is_featured:void 0}});P.value=o.data.data||[],g.total=o.data.total||0}catch(o){f.error(((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"获取商品列表失败")}finally{D.value=!1}},k=()=>{g.page=1,V()},X=()=>{p.keyword="",p.status=null,p.is_featured=null,k()},Y=()=>{R.value="添加商品",Object.assign(n,{id:null,name:"",slug:"",description:"",content:"",image:"",images:[],price:5.99,original_price:null,stock:100,sales:0,tags:[],is_featured:0,is_new:0,sort:100,status:1}),y.value=[],v.value=!0},Z=s=>{R.value="编辑商品";const e=[];s.is_featured&&e.push("featured"),s.is_new&&e.push("new"),Object.assign(n,{id:s.id,name:s.name,slug:s.slug,description:s.description,content:s.content,image:s.image,images:s.images||[],price:s.price,original_price:s.original_price,stock:s.stock,sales:s.sales,tags:e,is_featured:s.is_featured,is_new:s.is_new,sort:s.sort,status:s.status}),s.images&&Array.isArray(s.images)&&s.images.length>0?y.value=s.images.map((o,i)=>{let m=o;return o&&!o.startsWith("http")&&(m=B(o)),{uid:Date.now()+i,name:`image-${i}`,status:"success",url:m,_originalUrl:o}}):y.value=[],v.value=!0},ee=(s,e,o)=>{s.code===200?A(o):f.error(s.message||"图片上传失败")},te=(s,e)=>{A(e)},A=s=>{n.images=s.map(e=>{let o="";if(e._originalUrl?o=e._originalUrl:e.response&&e.response.data&&e.response.data.url?o=e.response.data.url:e.url&&(o=e.url),o&&(o.includes("http://")||o.includes("https://")))try{o=new URL(o).pathname}catch{const m=o.match(/\/uploads\/.*/);m&&(o=m[0])}return o}).filter(e=>e),n.image=n.images[0]||"",console.log("Updated images:",n.images)},le=async()=>{var o,i;if(!await T.value.validate().catch(()=>!1))return;const e={...n};e.is_featured=n.tags.includes("featured")?1:0,e.is_new=n.tags.includes("new")?1:0,e.status=e.status?1:0,I.value=!0;try{n.id?(await x.put(`/api/admin/products/${n.id}`,e),f.success("更新成功")):(await x.post("/api/admin/products",e),f.success("添加成功")),v.value=!1,V()}catch(m){f.error(((i=(o=m.response)==null?void 0:o.data)==null?void 0:i.message)||"操作失败")}finally{I.value=!1}},ae=async s=>{var o,i;const e=s.status?0:1;try{await x.put(`/api/admin/products/${s.id}/status`,{status:e}),f.success("状态更新成功"),V()}catch(m){f.error(((i=(o=m.response)==null?void 0:o.data)==null?void 0:i.message)||"操作失败")}},se=s=>{ve.confirm("确定要删除这个商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,o;try{await x.delete(`/api/admin/products/${s.id}`),f.success("删除成功"),V()}catch(i){f.error(((o=(e=i.response)==null?void 0:e.data)==null?void 0:o.message)||"删除失败")}})};return fe(()=>{V()}),(s,e)=>{const o=u("el-icon"),i=u("el-button"),m=u("el-input"),r=u("el-form-item"),U=u("el-option"),E=u("el-select"),M=u("el-form"),N=u("el-card"),c=u("el-table-column"),oe=u("el-image"),j=u("el-tag"),ne=u("el-table"),ie=u("el-pagination"),ue=u("el-upload"),w=u("el-input-number"),O=u("el-radio"),re=u("el-radio-group"),H=u("el-checkbox"),de=u("el-checkbox-group"),pe=u("el-dialog"),me=_e("loading");return b(),h("div",ye,[C("div",Ve,[e[20]||(e[20]=C("h2",null,"商品管理",-1)),t(i,{type:"primary",onClick:Y},{default:a(()=>[t(o,null,{default:a(()=>[t(W(J))]),_:1}),e[19]||(e[19]=d(" 添加商品 ",-1))]),_:1})]),t(N,{class:"search-card"},{default:a(()=>[t(M,{inline:!0,model:p},{default:a(()=>[t(r,{label:"商品名称"},{default:a(()=>[t(m,{modelValue:p.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>p.keyword=l),placeholder:"搜索商品名称",clearable:"",onClear:k},null,8,["modelValue"])]),_:1}),t(r,{label:"状态"},{default:a(()=>[t(E,{modelValue:p.status,"onUpdate:modelValue":e[1]||(e[1]=l=>p.status=l),placeholder:"全部",clearable:""},{default:a(()=>[t(U,{label:"上架",value:1}),t(U,{label:"下架",value:0})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"精选"},{default:a(()=>[t(E,{modelValue:p.is_featured,"onUpdate:modelValue":e[2]||(e[2]=l=>p.is_featured=l),placeholder:"全部",clearable:""},{default:a(()=>[t(U,{label:"是",value:1}),t(U,{label:"否",value:0})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(i,{type:"primary",onClick:k},{default:a(()=>[...e[21]||(e[21]=[d("搜索",-1)])]),_:1}),t(i,{onClick:X},{default:a(()=>[...e[22]||(e[22]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{class:"table-card"},{default:a(()=>[be((b(),z(ne,{data:P.value,border:"",stripe:""},{default:a(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{prop:"image",label:"图片",width:"100"},{default:a(({row:l})=>[l.image?(b(),z(oe,{key:0,src:B(l.image),"preview-src-list":[B(l.image)],fit:"cover",style:{width:"60px",height:"60px","border-radius":"4px"}},null,8,["src","preview-src-list"])):S("",!0)]),_:1}),t(c,{prop:"name",label:"商品名称","min-width":"200","show-overflow-tooltip":""}),t(c,{prop:"price",label:"价格",width:"100"},{default:a(({row:l})=>[d(" £"+$(l.price),1)]),_:1}),t(c,{prop:"original_price",label:"原价",width:"100"},{default:a(({row:l})=>[l.original_price?(b(),h("span",ke,"£"+$(l.original_price),1)):(b(),h("span",we,"-"))]),_:1}),t(c,{prop:"stock",label:"库存",width:"80"}),t(c,{prop:"sales",label:"销量",width:"80"}),t(c,{label:"标签",width:"150"},{default:a(({row:l})=>[l.is_featured?(b(),z(j,{key:0,type:"warning",size:"small"},{default:a(()=>[...e[23]||(e[23]=[d("精选",-1)])]),_:1})):S("",!0),l.is_new?(b(),z(j,{key:1,type:"success",size:"small",style:{"margin-left":"4px"}},{default:a(()=>[...e[24]||(e[24]=[d("新品",-1)])]),_:1})):S("",!0),!l.is_featured&&!l.is_new?(b(),h("span",xe,"-")):S("",!0)]),_:1}),t(c,{prop:"sort",label:"排序",width:"80",sortable:""}),t(c,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(j,{type:l.status?"success":"danger"},{default:a(()=>[d($(l.status?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),t(c,{label:"操作",width:"220",fixed:"right"},{default:a(({row:l})=>[t(i,{size:"small",onClick:F=>Z(l)},{default:a(()=>[...e[25]||(e[25]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:l.status?"warning":"success",onClick:F=>ae(l)},{default:a(()=>[d($(l.status?"下架":"上架"),1)]),_:2},1032,["type","onClick"]),t(i,{size:"small",type:"danger",onClick:F=>se(l)},{default:a(()=>[...e[26]||(e[26]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,D.value]]),t(ie,{"current-page":g.page,"onUpdate:currentPage":e[3]||(e[3]=l=>g.page=l),"page-size":g.limit,"onUpdate:pageSize":e[4]||(e[4]=l=>g.limit=l),total:g.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:k,onCurrentChange:k},null,8,["current-page","page-size","total"])]),_:1}),t(pe,{modelValue:v.value,"onUpdate:modelValue":e[18]||(e[18]=l=>v.value=l),title:R.value,width:"800px"},{footer:a(()=>[t(i,{onClick:e[17]||(e[17]=l=>v.value=!1)},{default:a(()=>[...e[32]||(e[32]=[d("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:le,loading:I.value},{default:a(()=>[...e[33]||(e[33]=[d(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(M,{ref_key:"formRef",ref:T,model:n,rules:K,"label-width":"120px","label-position":"top"},{default:a(()=>[t(r,{label:"商品名称",prop:"name"},{default:a(()=>[t(m,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=l=>n.name=l),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),t(r,{label:"Slug",prop:"slug"},{default:a(()=>[t(m,{modelValue:n.slug,"onUpdate:modelValue":e[6]||(e[6]=l=>n.slug=l),placeholder:"URL友好名称"},null,8,["modelValue"])]),_:1}),t(r,{label:"商品图片",prop:"images"},{default:a(()=>[C("div",Ue,[e[27]||(e[27]=C("div",{class:"upload-tip"},"可上传多张图片，第一张为主图",-1)),t(ue,{"file-list":y.value,"onUpdate:fileList":e[7]||(e[7]=l=>y.value=l),action:Q.value,headers:G.value,"list-type":"picture-card","on-success":ee,"on-remove":te,limit:5,accept:"image/*",multiple:""},{default:a(()=>[t(o,null,{default:a(()=>[t(W(J))]),_:1})]),_:1},8,["file-list","action","headers"])])]),_:1}),t(r,{label:"商品描述",prop:"description"},{default:a(()=>[t(m,{modelValue:n.description,"onUpdate:modelValue":e[8]||(e[8]=l=>n.description=l),type:"textarea",rows:3,placeholder:"请输入商品描述"},null,8,["modelValue"])]),_:1}),t(r,{label:"详细内容",prop:"content"},{default:a(()=>[t(m,{modelValue:n.content,"onUpdate:modelValue":e[9]||(e[9]=l=>n.content=l),type:"textarea",rows:4,placeholder:"支持HTML格式"},null,8,["modelValue"])]),_:1}),t(r,{label:"价格",prop:"price"},{default:a(()=>[t(w,{modelValue:n.price,"onUpdate:modelValue":e[10]||(e[10]=l=>n.price=l),min:0,precision:2,step:.1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(r,{label:"原价",prop:"original_price"},{default:a(()=>[t(w,{modelValue:n.original_price,"onUpdate:modelValue":e[11]||(e[11]=l=>n.original_price=l),min:0,precision:2,step:.1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(r,{label:"库存",prop:"stock"},{default:a(()=>[t(w,{modelValue:n.stock,"onUpdate:modelValue":e[12]||(e[12]=l=>n.stock=l),min:0,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(r,{label:"排序",prop:"sort"},{default:a(()=>[t(w,{modelValue:n.sort,"onUpdate:modelValue":e[13]||(e[13]=l=>n.sort=l),min:0,max:999,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(r,{label:"销量",prop:"sales"},{default:a(()=>[t(w,{modelValue:n.sales,"onUpdate:modelValue":e[14]||(e[14]=l=>n.sales=l),min:0,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(r,{label:"商品状态",prop:"status",required:""},{default:a(()=>[t(re,{modelValue:n.status,"onUpdate:modelValue":e[15]||(e[15]=l=>n.status=l)},{default:a(()=>[t(O,{label:1},{default:a(()=>[...e[28]||(e[28]=[d("上架",-1)])]),_:1}),t(O,{label:0},{default:a(()=>[...e[29]||(e[29]=[d("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"商品标签"},{default:a(()=>[t(de,{modelValue:n.tags,"onUpdate:modelValue":e[16]||(e[16]=l=>n.tags=l)},{default:a(()=>[t(H,{label:"featured"},{default:a(()=>[...e[30]||(e[30]=[d("精选商品",-1)])]),_:1}),t(H,{label:"new"},{default:a(()=>[...e[31]||(e[31]=[d("新品",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},$e=ce(he,[["__scopeId","data-v-c5350f46"]]);export{$e as default};
