import{_ as S,I as O,u as R,r as c,o as T,b,d as y,e as f,f as s,i as t,w as l,j as i,t as w,k,N as $,M as q,L as x}from"./index-dc0220d7.js";import{g as B}from"./payment-7a4b100c.js";const I={class:"payment-result-page"},V={class:"container"},M={class:"result-card"},A={key:0,class:"result-content success"},D={class:"order-info"},F={class:"actions"},Y={key:1,class:"result-content failed"},j={class:"desc"},E={class:"actions"},L={key:2,class:"result-content processing"},G={__name:"PaymentResult",setup(H){const p=O(),v=R(),o=c("processing"),m=c(""),P=c(""),_=c(""),r=c(""),C=async()=>{var d,e;try{m.value=p.query.order_no||p.query.out_trade_no;const a=p.query.status,n=p.query.session_id;if(!m.value){o.value="failed",r.value="Order number not found";return}if(a==="success")await new Promise(N=>setTimeout(N,1e3));else if(a==="failed"){o.value="failed",r.value="Payment was cancelled or failed";return}const g=n?{session_id:n}:{},u=(await B(m.value,g)).data.data;_.value=u.order_id,P.value=u.amount,u.pay_status===1||u.status==="paid"?(o.value="success",window.paymentCheckCount=0):u.status==="failed"?(o.value="failed",r.value=u.error_message||"Payment failed"):(window.paymentCheckCount||(window.paymentCheckCount=0),window.paymentCheckCount++,window.paymentCheckCount<10?setTimeout(C,2e3):(o.value="failed",r.value="Payment verification timeout. Please check your order status."))}catch(a){o.value="failed",r.value=((e=(d=a.response)==null?void 0:d.data)==null?void 0:e.message)||"Failed to verify payment status"}},z=()=>{v.push("/user-center/orders")},h=()=>{_.value?v.push(`/payment/${_.value}`):v.push("/orders")};return T(()=>{C()}),(d,e)=>{const a=b("el-icon"),n=b("el-button");return y(),f("div",I,[s("div",V,[s("div",M,[o.value==="success"?(y(),f("div",A,[t(a,{class:"result-icon",size:80},{default:l(()=>[t(k($))]),_:1}),e[6]||(e[6]=s("h1",null,"Payment Successful!",-1)),e[7]||(e[7]=s("p",{class:"desc"},"Your order has been confirmed and will be processed soon.",-1)),s("div",D,[s("p",null,[e[2]||(e[2]=s("strong",null,"Order No:",-1)),i(" "+w(m.value),1)]),s("p",null,[e[3]||(e[3]=s("strong",null,"Amount Paid:",-1)),i(" Â¥"+w(P.value),1)])]),s("div",F,[t(n,{type:"primary",size:"large",onClick:z},{default:l(()=>[...e[4]||(e[4]=[i(" View Orders ",-1)])]),_:1}),t(n,{size:"large",onClick:e[0]||(e[0]=g=>d.$router.push("/"))},{default:l(()=>[...e[5]||(e[5]=[i(" Continue Shopping ",-1)])]),_:1})])])):o.value==="failed"?(y(),f("div",Y,[t(a,{class:"result-icon",size:80},{default:l(()=>[t(k(q))]),_:1}),e[10]||(e[10]=s("h1",null,"Payment Failed",-1)),s("p",j,w(r.value||"Your payment could not be processed. Please try again."),1),s("div",E,[t(n,{type:"primary",size:"large",onClick:h},{default:l(()=>[...e[8]||(e[8]=[i(" Try Again ",-1)])]),_:1}),t(n,{size:"large",onClick:e[1]||(e[1]=g=>d.$router.push("/orders"))},{default:l(()=>[...e[9]||(e[9]=[i(" Back to Orders ",-1)])]),_:1})])])):(y(),f("div",L,[t(a,{class:"result-icon spinning",size:80},{default:l(()=>[t(k(x))]),_:1}),e[11]||(e[11]=s("h1",null,"Processing Payment...",-1)),e[12]||(e[12]=s("p",{class:"desc"},"Please wait while we confirm your payment.",-1))]))])])])}}},U=S(G,[["__scopeId","data-v-aec85e38"]]);export{U as default};
