import{_ as V,I as B,u as N,a as T,r as d,o as R,b as U,d as l,e as i,f as e,F as $,g as j,h as p,t as n,j as q,i as A,K as k,n as z}from"./index-dc0220d7.js";import{a as M}from"./product-3eb05e62.js";import{g as H}from"./shipping-cb1b4a6b.js";import{u as O}from"./cart-5154d6d7.js";const E={class:"product-detail-page"},K={key:0,class:"container"},Q={class:"product-detail-wrapper"},W={class:"product-gallery"},G={class:"main-image"},J=["src","alt"],X={key:0,class:"thumbnail-list"},Y=["onClick"],Z=["src","alt"],ee={class:"product-info-col"},se={class:"product-title"},te={class:"product-price"},ae={class:"product-description"},oe={class:"product-meta"},le={key:0,class:"meta-item"},ie={class:"value"},ne={key:1,class:"meta-item"},re={class:"value"},ue={key:0,style:{color:"#67c23a","font-size":"12px"}},ce={key:2,class:"meta-item"},de={class:"purchase-actions"},pe={class:"quantity-wrapper"},ve={class:"order-summary"},_e={class:"summary-row"},he={key:0,class:"summary-row"},ge={key:1,class:"summary-row"},me={key:2,class:"summary-row discount"},fe={style:{color:"#67c23a"}},ye={class:"summary-row total"},be={class:"btn-group"},ke=["disabled"],we=["disabled"],Fe=["innerHTML"],Se={__name:"ProductDetail",setup(Ie){const S=B(),w=N(),I=O(),m=T(),x="https://www.aizhong168.cn",y=a=>a?a.startsWith("http")?a:`${x}${a}`:"",s=d(null),r=d(1),_=d(!1),h=d(""),f=d([]),o=d(null),b=d(!1),g=d(0);R(async()=>{var a,t;try{const u=await M(S.params.id);s.value=u.data.data;const c=await H();if(o.value=c.data.data,m.isLoggedIn&&(await m.fetchUserInfo(),((a=m.userInfo)==null?void 0:a.first_order_discount)===1))try{const F=await(await fetch("/api/off-code/promotion")).json();(t=F.data)!=null&&t.active&&(b.value=!0,g.value=F.data.discount_value||10)}catch(v){console.error("Failed to get promotion info:",v)}s.value.images&&Array.isArray(s.value.images)&&s.value.images.length>0?(f.value=s.value.images.map(v=>y(v)),h.value=y(s.value.images[0])):s.value.image?(f.value=[y(s.value.image)],h.value=y(s.value.image)):(f.value=["/placeholder-product.jpg"],h.value="/placeholder-product.jpg")}catch(u){console.error("Fetch product error:",u)}});const C=async()=>{if(!m.isLoggedIn){k.warning("Please login first"),w.push("/login");return}_.value=!0;try{await I.addItem(s.value.id,r.value)}catch(a){k.error(a.message||"Failed to add to cart")}finally{_.value=!1}},D=()=>!s.value||!b.value?"0.00":(parseFloat(s.value.price)*parseInt(r.value)*(g.value/100)).toFixed(2),L=()=>{if(!s.value)return"0.00";const a=parseFloat(s.value.price)*parseInt(r.value);let t=0,u=0;return o.value&&o.value.shipping_fee&&parseFloat(o.value.shipping_fee)>0&&(o.value.free_shipping_threshold&&parseFloat(o.value.free_shipping_threshold)>0&&a>=parseFloat(o.value.free_shipping_threshold)?t=0:t=parseFloat(o.value.shipping_fee)),b.value&&g.value>0&&(u=a*(g.value/100)),(a+t-u).toFixed(2)},P=async()=>{if(!m.isLoggedIn){k.warning("Please login first"),w.push("/login");return}_.value=!0;try{w.push({path:"/orders/create",query:{type:"buynow",productId:s.value.id,quantity:r.value}})}catch(a){k.error(a.message||"Failed to proceed")}finally{_.value=!1}};return(a,t)=>{const u=U("el-input-number");return l(),i("div",E,[s.value?(l(),i("div",K,[e("div",Q,[e("div",W,[e("div",G,[e("img",{src:h.value,alt:s.value.name},null,8,J)]),f.value.length>1?(l(),i("div",X,[(l(!0),i($,null,j(f.value,(c,v)=>(l(),i("div",{key:v,class:z(["thumbnail-item",{active:h.value===c}]),onClick:F=>h.value=c},[e("img",{src:c,alt:`${s.value.name} - ${v+1}`},null,8,Z)],10,Y))),128))])):p("",!0)]),e("div",ee,[e("h1",se,n(s.value.name),1),e("div",te,"£"+n(s.value.price),1),e("div",ae,[e("p",null,n(s.value.description),1)]),e("div",oe,[s.value.stock?(l(),i("div",le,[t[1]||(t[1]=e("span",{class:"label"},"Stock:",-1)),e("span",ie,n(s.value.stock),1)])):p("",!0),s.value.shipping_fee>0?(l(),i("div",ne,[t[2]||(t[2]=e("span",{class:"label"},"Shipping:",-1)),e("span",re,[q(" £"+n(s.value.shipping_fee)+" ",1),s.value.free_shipping_threshold>0?(l(),i("span",ue," (Free shipping over £"+n(s.value.free_shipping_threshold)+") ",1)):p("",!0)])])):s.value.shipping_fee===0?(l(),i("div",ce,[...t[3]||(t[3]=[e("span",{class:"label"},"Shipping:",-1),e("span",{class:"value",style:{color:"#67c23a"}},"Free Shipping",-1)])])):p("",!0)]),e("div",de,[e("div",pe,[t[4]||(t[4]=e("label",null,"Quantity:",-1)),A(u,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=c=>r.value=c),min:1,max:s.value.stock||100},null,8,["modelValue","max"])]),e("div",ve,[e("div",_e,[t[5]||(t[5]=e("span",null,"Subtotal:",-1)),e("span",null,"£"+n((s.value.price*r.value).toFixed(2)),1)]),o.value&&o.value.shipping_fee>0&&s.value.price*r.value<(o.value.free_shipping_threshold||0)?(l(),i("div",he,[t[6]||(t[6]=e("span",null,"Shipping:",-1)),e("span",null,"£"+n(o.value.shipping_fee),1)])):o.value&&o.value.shipping_fee>0&&o.value.free_shipping_threshold&&s.value.price*r.value>=o.value.free_shipping_threshold?(l(),i("div",ge,[...t[7]||(t[7]=[e("span",null,"Shipping:",-1),e("span",{style:{color:"#67c23a"}},"Free",-1)])])):p("",!0),b.value&&g.value>0?(l(),i("div",me,[e("span",null,"First Order Discount ("+n(g.value)+"%):",1),e("span",fe,"-£"+n(D()),1)])):p("",!0),e("div",ye,[t[8]||(t[8]=e("span",null,"Total:",-1)),e("span",null,"£"+n(L()),1)])]),e("div",be,[e("button",{class:"btn-add-cart",onClick:C,disabled:_.value}," Add to Cart ",8,ke),e("button",{class:"btn-checkout",onClick:P,disabled:_.value}," Buy It Now ",8,we)])]),s.value.content?(l(),i("div",{key:0,class:"product-content",innerHTML:s.value.content},null,8,Fe)):p("",!0)])])])):p("",!0)])}}},Pe=V(Se,[["__scopeId","data-v-557f905f"]]);export{Pe as default};
