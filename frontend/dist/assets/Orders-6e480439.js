import{_ as H,u as K,r as y,o as L,a4 as G,b as g,d as i,e as d,i as l,w as r,h as p,f as e,F as N,g as M,l as w,t as n,P as J,K as V,j as u,A as Q,k as F,V as X,a5 as Z}from"./index-dc0220d7.js";import{a as tt,b as et,g as st}from"./order-cd7f84b2.js";const at={class:"orders-page"},nt={key:0},lt={key:1,class:"orders-table"},ot={class:"order-cards"},rt=["onClick"],it={class:"card-header"},ut={class:"order-no"},dt={class:"card-body"},ct={class:"order-info-row"},pt={class:"value"},_t={class:"order-info-row"},vt={class:"value amount"},mt={class:"card-footer"},gt={key:1,class:"pagination"},ft={key:2,class:"order-detail-view pc-only"},yt={class:"order-detail"},ht={class:"detail-section"},bt={key:0,class:"countdown-inline"},wt={class:"detail-section"},kt=["src","alt"],Ct={class:"product-info"},Ot={class:"name"},xt={class:"spec"},St={class:"product-total"},Tt={class:"detail-section"},$t={class:"detail-section"},Pt={class:"amount-details"},Dt={class:"total-row"},Nt={key:0,class:"total-row"},Mt={key:1,class:"total-row discount"},Vt={class:"discount-text"},zt={class:"total-row final"},At={class:"amount"},Bt={class:"detail-section"},It=6e4,Et={__name:"Orders",setup(Ft){const z=K(),k=y("all"),f=y([]),C=y(1),S=y(0),s=y(null),T=y(null);L(()=>{O(),U()}),G(()=>{T.value&&clearInterval(T.value)});const U=()=>{T.value=setInterval(()=>{f.value=[...f.value]},1e3)},A=o=>{if(!o)return"";let t=o;typeof t=="string"&&(t=t.replace(" ","T"));const c=new Date(t).getTime(),h=Date.now(),_=c+It-h;if(_<=0)return"Expired";const v=Math.floor(_/(1e3*60)),b=Math.floor(_%(1e3*60)/1e3);return`${v}m ${b}s`},O=async()=>{const o={page:C.value};k.value!=="all"&&(o.status=k.value);const t=await tt(o);f.value=t.data.data.data||[],S.value=t.data.data.total||0},R=()=>{C.value=1,O()},$=o=>({0:"warning",1:"primary",3:"success",4:"info"})[o]||"info",P=o=>({0:"Pending",1:"Processing",3:"Completed",4:"Cancelled"})[o]||"Unknown",x=o=>{if(!o)return"";const t=new Date(o),c=t.getFullYear(),h=String(t.getMonth()+1).padStart(2,"0"),_=String(t.getDate()).padStart(2,"0"),v=String(t.getHours()).padStart(2,"0"),b=String(t.getMinutes()).padStart(2,"0");return`${c}/${h}/${_} ${v}:${b}`},D=async o=>{if(window.innerWidth<=768){z.push(`/user-center/orders/${o}`);return}try{const t=await st(o);s.value=t.data.data}catch{V.error("获取订单详情失败")}},q=o=>{z.push(`/payment/${o}`)},W=o=>{var c;const t=((c=o.product)==null?void 0:c.image)||o.product_image;return t?t.startsWith("http")?t:`https://www.aizhong168.cn${t}`:"https://via.placeholder.com/80"},Y=async o=>{try{await J.confirm("Are you sure you want to cancel this order?","Confirm",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}),await et(o),V.success("Order cancelled"),s.value=null,O()}catch(t){t!=="cancel"&&V.error(t.message||"操作失败")}};return(o,t)=>{const c=g("el-tab-pane"),h=g("el-tabs"),_=g("el-tag"),v=g("el-button"),b=g("el-empty"),j=g("el-pagination"),B=g("el-icon"),m=g("el-descriptions-item"),I=g("el-descriptions");return i(),d("div",at,[s.value?p("",!0):(i(),d("div",nt,[l(h,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),onTabChange:R,class:"order-tabs"},{default:r(()=>[l(c,{label:"All Orders",name:"all"}),l(c,{label:"Pending",name:"0"}),l(c,{label:"Processing",name:"1"}),l(c,{label:"Completed",name:"3"}),l(c,{label:"Cancelled",name:"4"})]),_:1},8,["modelValue"])])),s.value?(i(),d("div",ft,[l(v,{class:"back-btn",onClick:t[2]||(t[2]=a=>s.value=null),type:"primary",plain:""},{default:r(()=>[l(B,null,{default:r(()=>[l(F(X))]),_:1}),t[10]||(t[10]=u(" Back to Orders ",-1))]),_:1}),e("div",yt,[e("div",ht,[t[11]||(t[11]=e("h3",null,"Order Information",-1)),l(I,{column:2,border:"",size:"small"},{default:r(()=>[l(m,{label:"Order No."},{default:r(()=>[u(n(s.value.order_no),1)]),_:1}),l(m,{label:"Order Time"},{default:r(()=>[u(n(x(s.value.created_at)),1)]),_:1}),l(m,{label:"Status"},{default:r(()=>[l(_,{type:$(s.value.status),size:"small"},{default:r(()=>[u(n(P(s.value.status)),1)]),_:1},8,["type"]),s.value.status===0&&A(s.value.created_at)!=="Expired"?(i(),d("div",bt,[l(B,null,{default:r(()=>[l(F(Z))]),_:1}),u(" "+n(A(s.value.created_at)),1)])):p("",!0)]),_:1}),l(m,{label:"Paid At"},{default:r(()=>[u(n(s.value.paid_at?x(s.value.paid_at):"-"),1)]),_:1})]),_:1})]),e("div",wt,[t[12]||(t[12]=e("h3",null,"Products",-1)),(i(!0),d(N,null,M(s.value.items,a=>(i(),d("div",{key:a.id,class:"product-item"},[e("img",{src:W(a),alt:a.product_name},null,8,kt),e("div",Ct,[e("p",Ot,n(a.product_name),1),e("p",xt,"£"+n(a.price)+" x "+n(a.quantity),1)]),e("div",St,"£"+n((a.price*a.quantity).toFixed(2)),1)]))),128))]),e("div",Tt,[t[13]||(t[13]=e("h3",null,"Shipping Information",-1)),l(I,{column:1,border:"",size:"small"},{default:r(()=>[l(m,{label:"Recipient"},{default:r(()=>[u(n(s.value.shipping_name),1)]),_:1}),l(m,{label:"Phone"},{default:r(()=>[u(n(s.value.shipping_phone),1)]),_:1}),l(m,{label:"Address"},{default:r(()=>[u(n(s.value.shipping_address),1)]),_:1}),s.value.shipping_company?(i(),w(m,{key:0,label:"Carrier"},{default:r(()=>[u(n(s.value.shipping_company),1)]),_:1})):p("",!0),s.value.shipping_no?(i(),w(m,{key:1,label:"Tracking No."},{default:r(()=>[u(n(s.value.shipping_no),1)]),_:1})):p("",!0)]),_:1})]),e("div",$t,[t[17]||(t[17]=e("h3",null,"Amount Summary",-1)),e("div",Pt,[e("div",Dt,[t[14]||(t[14]=e("span",null,"Subtotal:",-1)),e("span",null,"£"+n(s.value.total_amount),1)]),s.value.shipping_fee>0?(i(),d("div",Nt,[t[15]||(t[15]=e("span",null,"Shipping:",-1)),e("span",null,"£"+n(s.value.shipping_fee),1)])):p("",!0),s.value.discount_amount>0?(i(),d("div",Mt,[e("span",null,n(s.value.promotion_id===1?"First Order Discount:":"Discount:"),1),e("span",Vt,"-£"+n(s.value.discount_amount),1)])):p("",!0),e("div",zt,[t[16]||(t[16]=e("span",null,"Total:",-1)),e("span",At,"£"+n(s.value.pay_amount),1)])])]),e("div",Bt,[s.value.status===0?(i(),w(v,{key:0,type:"primary",onClick:t[3]||(t[3]=a=>q(s.value.id))},{default:r(()=>[...t[18]||(t[18]=[u(" Pay Now ",-1)])]),_:1})):p("",!0),s.value.status===0?(i(),w(v,{key:1,onClick:t[4]||(t[4]=a=>Y(s.value.id))},{default:r(()=>[...t[19]||(t[19]=[u(" Cancel Order ",-1)])]),_:1})):p("",!0)])])])):(i(),d("div",lt,[e("table",null,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",null,"Order No."),e("th",null,"Order Time"),e("th",null,"Status"),e("th",null,"Amount"),e("th",null,"Action")])],-1)),e("tbody",null,[(i(!0),d(N,null,M(f.value,a=>(i(),d("tr",{key:a.id,class:"order-row"},[e("td",null,n(a.order_no),1),e("td",null,n(x(a.created_at)),1),e("td",null,[l(_,{type:$(a.status),size:"small"},{default:r(()=>[u(n(P(a.status)),1)]),_:2},1032,["type"])]),e("td",null,"£"+n(a.pay_amount),1),e("td",null,[l(v,{link:"",type:"primary",onClick:E=>D(a.id)},{default:r(()=>[...t[5]||(t[5]=[u("Details",-1)])]),_:1},8,["onClick"])])]))),128))])]),e("div",ot,[(i(!0),d(N,null,M(f.value,a=>(i(),d("div",{key:a.id,class:"order-card",onClick:E=>D(a.id)},[e("div",it,[e("div",ut,"Order: "+n(a.order_no),1),l(_,{type:$(a.status),size:"small"},{default:r(()=>[u(n(P(a.status)),1)]),_:2},1032,["type"])]),e("div",dt,[e("div",ct,[t[7]||(t[7]=e("span",{class:"label"},"Order Time:",-1)),e("span",pt,n(x(a.created_at)),1)]),e("div",_t,[t[8]||(t[8]=e("span",{class:"label"},"Amount:",-1)),e("span",vt,"£"+n(a.pay_amount),1)])]),e("div",mt,[l(v,{type:"primary",size:"small",onClick:Q(E=>D(a.id),["stop"])},{default:r(()=>[...t[9]||(t[9]=[u(" View Details ",-1)])]),_:1},8,["onClick"])])],8,rt))),128))]),f.value.length?p("",!0):(i(),w(b,{key:0,description:"No orders yet"})),S.value>0?(i(),d("div",gt,[l(j,{"current-page":C.value,"onUpdate:currentPage":t[1]||(t[1]=a=>C.value=a),total:S.value,"page-size":15,layout:"total, prev, pager, next",onCurrentChange:O},null,8,["current-page","total"])])):p("",!0)]))])}}},qt=H(Et,[["__scopeId","data-v-bd84b065"]]);export{qt as default};
