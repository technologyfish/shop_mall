import{_ as G,r as f,J as S,o as K,b as r,ab as L,d as B,e as X,f as k,i as t,w as l,H as b,Q as p,k as C,R as Y,j as g,C as Z,l as N,h as ee,t as $,P as te}from"./index-dc0220d7.js";import{g as O}from"./image-da0f5490.js";import{I as ae}from"./ImageUpload-9701b259.js";/* empty css                                                                    */const le={class:"banners-container"},ne={class:"page-header"},oe={__name:"Banners",setup(se){const y=f(!1),V=f(!1),h=f([]),d=S({page:1,limit:10,total:0}),c=f(!1),x=f("添加Banner"),U=f(null),n=S({id:null,title:"",subtitle:"",image:"",link:"",button_text:"",sort:100,status:1}),j={title:[{required:!0,message:"请输入标题",trigger:"blur"}],image:[{required:!0,message:"请上传Banner图片",trigger:"change"}]},_=async()=>{var s,e;y.value=!0;try{const{data:i}=await b.get("/api/admin/banners",{params:{page:d.page,limit:d.limit}});h.value=i.data.data||[],d.total=i.data.total||0}catch(i){p.error(((e=(s=i.response)==null?void 0:s.data)==null?void 0:e.message)||"获取Banner列表失败")}finally{y.value=!1}},D=()=>{x.value="添加Banner",Object.assign(n,{id:null,title:"",subtitle:"",image:"",link:"/shop",button_text:"SHOP NOW",sort:100,status:1}),c.value=!0},I=s=>{x.value="编辑Banner",Object.assign(n,s),c.value=!0},T=async()=>{var e,i;if(await U.value.validate().catch(()=>!1)){V.value=!0;try{const o={...n,position:"home"};n.id?(await b.put(`/api/admin/banners/${n.id}`,o),p.success("更新成功")):(await b.post("/api/admin/banners",o),p.success("添加成功")),c.value=!1,_()}catch(o){p.error(((i=(e=o.response)==null?void 0:e.data)==null?void 0:i.message)||"操作失败")}finally{V.value=!1}}},E=async s=>{var o,u;const e=s.status,i=Number(s.status)===1?0:1;try{s.status=i,await b.put(`/api/admin/banners/${s.id}`,{...s,status:i}),p.success("状态更新成功"),await _()}catch(w){s.status=e,p.error(((u=(o=w.response)==null?void 0:o.data)==null?void 0:u.message)||"操作失败")}},M=s=>{te.confirm("确定要删除这个Banner吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,i;try{await b.delete(`/api/admin/banners/${s.id}`),p.success("删除成功"),_()}catch(o){p.error(((i=(e=o.response)==null?void 0:e.data)==null?void 0:i.message)||"删除失败")}})};return K(()=>{_()}),(s,e)=>{const i=r("el-icon"),o=r("el-button"),u=r("el-table-column"),w=r("el-image"),P=r("el-tag"),q=r("el-table"),H=r("el-pagination"),R=r("el-card"),m=r("el-form-item"),v=r("el-input"),W=r("el-input-number"),A=r("el-switch"),J=r("el-form"),Q=r("el-dialog"),F=L("loading");return B(),X("div",le,[k("div",ne,[e[12]||(e[12]=k("h2",null,"Banner管理",-1)),t(o,{type:"primary",onClick:D},{default:l(()=>[t(i,null,{default:l(()=>[t(C(Y))]),_:1}),e[11]||(e[11]=g(" 添加Banner ",-1))]),_:1})]),t(R,{class:"table-card"},{default:l(()=>[Z((B(),N(q,{data:h.value,border:"",stripe:""},{default:l(()=>[t(u,{prop:"id",label:"ID",width:"80"}),t(u,{prop:"image",label:"图片",width:"150"},{default:l(({row:a})=>[a.image?(B(),N(w,{key:0,src:C(O)(a.image),"preview-src-list":[C(O)(a.image)],fit:"cover",style:{width:"120px",height:"60px","border-radius":"4px"}},null,8,["src","preview-src-list"])):ee("",!0)]),_:1}),t(u,{prop:"title",label:"标题","min-width":"150"}),t(u,{prop:"subtitle",label:"副标题","min-width":"200","show-overflow-tooltip":""}),t(u,{prop:"button_text",label:"按钮文字",width:"120"}),t(u,{prop:"link",label:"链接",width:"120","show-overflow-tooltip":""}),t(u,{prop:"sort",label:"排序",width:"100",sortable:""}),t(u,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(P,{type:a.status===1?"success":"danger"},{default:l(()=>[g($(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[t(o,{size:"small",onClick:z=>I(a)},{default:l(()=>[...e[13]||(e[13]=[g("编辑",-1)])]),_:1},8,["onClick"]),t(o,{size:"small",type:a.status===1?"warning":"success",onClick:z=>E(a)},{default:l(()=>[g($(a.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(o,{size:"small",type:"danger",onClick:z=>M(a)},{default:l(()=>[...e[14]||(e[14]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,y.value]]),t(H,{"current-page":d.page,"onUpdate:currentPage":e[0]||(e[0]=a=>d.page=a),"page-size":d.limit,"onUpdate:pageSize":e[1]||(e[1]=a=>d.limit=a),total:d.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1}),t(Q,{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=a=>c.value=a),title:x.value,width:"800px"},{footer:l(()=>[t(o,{onClick:e[9]||(e[9]=a=>c.value=!1)},{default:l(()=>[...e[16]||(e[16]=[g("取消",-1)])]),_:1}),t(o,{type:"primary",onClick:T,loading:V.value},{default:l(()=>[...e[17]||(e[17]=[g(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(J,{ref_key:"formRef",ref:U,model:n,rules:j,"label-width":"100px"},{default:l(()=>[t(m,{label:"Banner图片",prop:"image"},{default:l(()=>[t(ae,{modelValue:n.image,"onUpdate:modelValue":e[2]||(e[2]=a=>n.image=a),tip:"建议尺寸：1920x600，支持jpg、png、gif、webp，最大5MB"},null,8,["modelValue"])]),_:1}),t(m,{label:"标题",prop:"title"},{default:l(()=>[t(v,{modelValue:n.title,"onUpdate:modelValue":e[3]||(e[3]=a=>n.title=a),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"副标题",prop:"subtitle"},{default:l(()=>[t(v,{modelValue:n.subtitle,"onUpdate:modelValue":e[4]||(e[4]=a=>n.subtitle=a),type:"textarea",rows:2,placeholder:"请输入副标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"链接",prop:"link"},{default:l(()=>[t(v,{modelValue:n.link,"onUpdate:modelValue":e[5]||(e[5]=a=>n.link=a),placeholder:"请输入跳转链接，如：/shop"},null,8,["modelValue"])]),_:1}),t(m,{label:"按钮文字",prop:"button_text"},{default:l(()=>[t(v,{modelValue:n.button_text,"onUpdate:modelValue":e[6]||(e[6]=a=>n.button_text=a),placeholder:"请输入按钮文字，如：SHOP NOW"},null,8,["modelValue"])]),_:1}),t(m,{label:"排序",prop:"sort"},{default:l(()=>[t(W,{modelValue:n.sort,"onUpdate:modelValue":e[7]||(e[7]=a=>n.sort=a),min:0,max:999,"controls-position":"right"},null,8,["modelValue"]),e[15]||(e[15]=k("span",{class:"form-tip"},"数字越大越靠前",-1))]),_:1}),t(m,{label:"状态",prop:"status"},{default:l(()=>[t(A,{modelValue:n.status,"onUpdate:modelValue":e[8]||(e[8]=a=>n.status=a),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=G(oe,[["__scopeId","data-v-2a64cdf2"]]);export{pe as default};
