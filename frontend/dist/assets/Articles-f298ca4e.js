import{_ as F,r as f,J as B,o as G,b as r,ab as K,d as C,e as W,f as D,i as l,w as s,H as b,Q as p,k as v,R as X,j as c,C as Y,l as $,h as Z,t as k,P as ee}from"./index-dc0220d7.js";import{g as S}from"./image-da0f5490.js";import{I as te}from"./ImageUpload-9701b259.js";import{R as le}from"./RichTextEditor-60d7e47b.js";import{f as ae}from"./format-d9fb0471.js";/* empty css                                                                    */const se={class:"articles-container"},ie={class:"page-header"},oe={__name:"Articles",setup(ne){const y=f(!1),V=f(!1),h=f([]),d=B({page:1,limit:10,total:0}),m=f(!1),x=f("添加文章"),w=f(null),i=B({id:null,title:"",subtitle:"",image:"",content:"",status:1}),T={title:[{required:!0,message:"请输入标题",trigger:"blur"}],subtitle:[{required:!0,message:"请输入副标题",trigger:"blur"}],image:[{required:!0,message:"请上传封面图片",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},g=async()=>{var a,e;y.value=!0;try{const{data:n}=await b.get("/api/admin/articles",{params:{page:d.page,limit:d.limit}});h.value=n.data.data||[],d.total=n.data.total||0}catch(n){p.error(((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"获取文章列表失败")}finally{y.value=!1}},j=()=>{x.value="添加文章",Object.assign(i,{id:null,title:"",subtitle:"",image:"",content:"",status:1}),m.value=!0},q=a=>{x.value="编辑文章",Object.assign(i,{id:a.id,title:a.title,subtitle:a.subtitle,image:a.image,content:a.content,status:a.status}),m.value=!0},A=async()=>{var e,n;if(await w.value.validate().catch(()=>!1)){V.value=!0;try{const o={title:i.title,subtitle:i.subtitle,slug:i.title.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),image:i.image,content:i.content,type:"article",sort:100,status:i.status};i.id?(await b.put(`/api/admin/articles/${i.id}`,o),p.success("更新成功")):(await b.post("/api/admin/articles",o),p.success("添加成功")),m.value=!1,g()}catch(o){p.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"操作失败")}finally{V.value=!1}}},E=async a=>{var n,o;const e=Number(a.status)===1?0:1;try{await b.put(`/api/admin/articles/${a.id}`,{title:a.title,subtitle:a.subtitle,slug:a.slug,image:a.image,content:a.content,type:a.type||"article",sort:a.sort||100,status:e}),p.success("状态更新成功"),g()}catch(u){p.error(((o=(n=u.response)==null?void 0:n.data)==null?void 0:o.message)||"操作失败")}},I=a=>{ee.confirm("确定要删除这篇文章吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,n;try{await b.delete(`/api/admin/articles/${a.id}`),p.success("删除成功"),g()}catch(o){p.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"删除失败")}})};return G(()=>{g()}),(a,e)=>{const n=r("el-icon"),o=r("el-button"),u=r("el-table-column"),N=r("el-image"),R=r("el-tag"),M=r("el-table"),O=r("el-pagination"),P=r("el-card"),z=r("el-input"),_=r("el-form-item"),H=r("el-switch"),J=r("el-form"),L=r("el-dialog"),Q=K("loading");return C(),W("div",se,[D("div",ie,[e[10]||(e[10]=D("h2",null,"文章管理",-1)),l(o,{type:"primary",onClick:j},{default:s(()=>[l(n,null,{default:s(()=>[l(v(X))]),_:1}),e[9]||(e[9]=c(" 添加文章 ",-1))]),_:1})]),l(P,{class:"table-card"},{default:s(()=>[Y((C(),$(M,{data:h.value,border:"",stripe:""},{default:s(()=>[l(u,{prop:"id",label:"ID",width:"80"}),l(u,{prop:"image",label:"图片",width:"100"},{default:s(({row:t})=>[t.image?(C(),$(N,{key:0,src:v(S)(t.image),"preview-src-list":[v(S)(t.image)],fit:"cover",style:{width:"60px",height:"60px","border-radius":"4px"}},null,8,["src","preview-src-list"])):Z("",!0)]),_:1}),l(u,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),l(u,{prop:"subtitle",label:"副标题","min-width":"250","show-overflow-tooltip":""}),l(u,{prop:"status",label:"状态",width:"100"},{default:s(({row:t})=>[l(R,{type:t.status===1?"success":"info"},{default:s(()=>[c(k(t.status===1?"发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"created_at",label:"创建时间",width:"180"},{default:s(({row:t})=>[c(k(v(ae)(t.created_at)),1)]),_:1}),l(u,{label:"操作",width:"220",fixed:"right"},{default:s(({row:t})=>[l(o,{size:"small",onClick:U=>q(t)},{default:s(()=>[...e[11]||(e[11]=[c("编辑",-1)])]),_:1},8,["onClick"]),l(o,{size:"small",type:t.status===1?"warning":"success",onClick:U=>E(t)},{default:s(()=>[c(k(t.status===1?"下架":"发布"),1)]),_:2},1032,["type","onClick"]),l(o,{size:"small",type:"danger",onClick:U=>I(t)},{default:s(()=>[...e[12]||(e[12]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,y.value]]),l(O,{"current-page":d.page,"onUpdate:currentPage":e[0]||(e[0]=t=>d.page=t),"page-size":d.limit,"onUpdate:pageSize":e[1]||(e[1]=t=>d.limit=t),total:d.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1}),l(L,{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=t=>m.value=t),title:x.value,width:"1000px","close-on-click-modal":!1},{footer:s(()=>[l(o,{onClick:e[7]||(e[7]=t=>m.value=!1)},{default:s(()=>[...e[13]||(e[13]=[c("取消",-1)])]),_:1}),l(o,{type:"primary",onClick:A,loading:V.value},{default:s(()=>[...e[14]||(e[14]=[c(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[l(J,{ref_key:"formRef",ref:w,model:i,rules:T,"label-width":"100px"},{default:s(()=>[l(_,{label:"标题",prop:"title"},{default:s(()=>[l(z,{modelValue:i.title,"onUpdate:modelValue":e[2]||(e[2]=t=>i.title=t),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(_,{label:"副标题",prop:"subtitle"},{default:s(()=>[l(z,{modelValue:i.subtitle,"onUpdate:modelValue":e[3]||(e[3]=t=>i.subtitle=t),placeholder:"请输入副标题"},null,8,["modelValue"])]),_:1}),l(_,{label:"封面图片",prop:"image"},{default:s(()=>[l(te,{modelValue:i.image,"onUpdate:modelValue":e[4]||(e[4]=t=>i.image=t),tip:"建议尺寸：800x600，支持jpg、png、gif、webp，最大5MB"},null,8,["modelValue"])]),_:1}),l(_,{label:"内容",prop:"content"},{default:s(()=>[l(le,{modelValue:i.content,"onUpdate:modelValue":e[5]||(e[5]=t=>i.content=t),placeholder:"请输入文章内容...",height:"600px"},null,8,["modelValue"])]),_:1}),l(_,{label:"状态",prop:"status"},{default:s(()=>[l(H,{modelValue:i.status,"onUpdate:modelValue":e[6]||(e[6]=t=>i.status=t),"active-value":1,"inactive-value":0,"active-text":"发布","inactive-text":"草稿"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ge=F(oe,[["__scopeId","data-v-156cb9e8"]]);export{ge as default};
