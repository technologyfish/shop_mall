import{H as w,_ as Z,a9 as ee,r as v,J as z,c as M,o as te,Q as i,b as s,d as C,e as S,f as m,i as a,ah as ae,w as o,j as r,t as D,l as le,P as oe}from"./index-dc0220d7.js";function ne(u){return w({url:"/api/admin/photos",method:"get",params:u})}function se(u){return w({url:"/api/admin/photos",method:"post",data:u})}function ie(u,V){return w({url:`/api/admin/photos/${u}`,method:"put",data:V})}function de(u){return w({url:`/api/admin/photos/${u}`,method:"delete"})}const re={class:"admin-photos-page"},ue={class:"card"},pe={class:"filter-bar"},me=["src","alt"],ce={class:"pagination"},fe={key:0,class:"preview-image"},_e=["src"],ge={__name:"Photos",setup(u){const V=ee(),U=v([]),P=v(0),g=v(!1),k=v("添加照片"),x=v(!1),b=v(null),p=z({keyword:"",status:null,page:1,per_page:15}),n=z({name:"",image:"",description:"",sort:0,status:1}),E=M(()=>"https://www.aizhong168.cn/api/admin/upload"),I=M(()=>({Authorization:`Bearer ${V.token}`}));te(()=>{c()});const c=async()=>{try{const t=await ne(p);U.value=t.data.data.data||[],P.value=t.data.data.total||0}catch{i.error("获取照片列表失败")}},B=t=>t?t.startsWith("http")?t:`https://www.aizhong168.cn${t}`:"https://via.placeholder.com/100",N=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",T=()=>{k.value="添加照片",b.value=null,$(),g.value=!0},A=t=>{k.value="编辑照片",b.value=t.id,Object.assign(n,{name:t.name,image:t.image,description:t.description,sort:t.sort,status:t.status}),g.value=!0},j=t=>{var e;t.code===0||t.code===200||t.url?(n.image=((e=t.data)==null?void 0:e.url)||t.url,i.success("Upload successful")):i.error(t.message||"Upload failed")},H=t=>{const e=t.type.startsWith("image/"),d=t.size/1024/1024<2;return e?d?!0:(i.error("图片大小不能超过 2MB!"),!1):(i.error("只能上传图片文件!"),!1)},K=async()=>{var t,e;if(!n.name){i.warning("请输入照片名称");return}if(!n.image){i.warning("请上传照片图片");return}x.value=!0;try{b.value?(await ie(b.value,n),i.success("更新成功")):(await se(n),i.success("添加成功")),g.value=!1,c()}catch(d){i.error(((e=(t=d.response)==null?void 0:t.data)==null?void 0:e.message)||"操作失败")}finally{x.value=!1}},L=async t=>{var e,d;try{await oe.confirm("确定要删除这张照片吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await de(t),i.success("删除成功"),c()}catch(h){h!=="cancel"&&i.error(((d=(e=h.response)==null?void 0:e.data)==null?void 0:d.message)||"删除失败")}},$=()=>{n.name="",n.image="",n.description="",n.sort=0,n.status=1};return(t,e)=>{const d=s("el-input"),h=s("el-option"),W=s("el-select"),f=s("el-button"),_=s("el-table-column"),q=s("el-tag"),F=s("el-table"),J=s("el-pagination"),y=s("el-form-item"),O=s("el-upload"),Q=s("el-input-number"),G=s("el-switch"),R=s("el-form"),X=s("el-dialog");return C(),S("div",re,[e[17]||(e[17]=m("h1",{class:"page-title"},"Photo管理",-1)),m("div",ue,[m("div",pe,[a(d,{modelValue:p.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>p.keyword=l),placeholder:"搜索照片名称/描述",style:{width:"300px"},onKeyup:ae(c,["enter"])},null,8,["modelValue"]),a(W,{modelValue:p.status,"onUpdate:modelValue":e[1]||(e[1]=l=>p.status=l),placeholder:"状态",clearable:"",onChange:c,style:{width:"150px"}},{default:o(()=>[a(h,{label:"启用",value:1}),a(h,{label:"禁用",value:0})]),_:1},8,["modelValue"]),a(f,{type:"primary",onClick:c},{default:o(()=>[...e[9]||(e[9]=[r("搜索",-1)])]),_:1}),a(f,{type:"success",onClick:T},{default:o(()=>[...e[10]||(e[10]=[r("添加照片",-1)])]),_:1})]),a(F,{data:U.value,style:{width:"100%"}},{default:o(()=>[a(_,{label:"图片",width:"120"},{default:o(({row:l})=>[m("img",{src:B(l.image),alt:l.name,class:"photo-thumb"},null,8,me)]),_:1}),a(_,{prop:"name",label:"名称",width:"200"}),a(_,{prop:"description",label:"描述"}),a(_,{prop:"sort",label:"排序",width:"80"}),a(_,{label:"状态",width:"80"},{default:o(({row:l})=>[a(q,{type:l.status===1?"success":"info"},{default:o(()=>[r(D(l.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(_,{label:"添加时间",width:"180"},{default:o(({row:l})=>[r(D(N(l.created_at)),1)]),_:1}),a(_,{label:"操作",width:"150",fixed:"right"},{default:o(({row:l})=>[a(f,{link:"",type:"primary",onClick:Y=>A(l)},{default:o(()=>[...e[11]||(e[11]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(f,{link:"",type:"danger",onClick:Y=>L(l.id)},{default:o(()=>[...e[12]||(e[12]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),m("div",ce,[a(J,{"current-page":p.page,"onUpdate:currentPage":e[2]||(e[2]=l=>p.page=l),total:P.value,"page-size":p.per_page,layout:"total, prev, pager, next",onCurrentChange:c},null,8,["current-page","total","page-size"])])]),a(X,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=l=>g.value=l),title:k.value,width:"600px",onClose:$},{footer:o(()=>[a(f,{onClick:e[7]||(e[7]=l=>g.value=!1)},{default:o(()=>[...e[15]||(e[15]=[r("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:K,loading:x.value},{default:o(()=>[...e[16]||(e[16]=[r("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(R,{model:n,"label-width":"100px"},{default:o(()=>[a(y,{label:"照片名称"},{default:o(()=>[a(d,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.name=l),placeholder:"请输入照片名称"},null,8,["modelValue"])]),_:1}),a(y,{label:"照片图片"},{default:o(()=>[a(O,{class:"upload-demo",action:E.value,headers:I.value,"on-success":j,"before-upload":H,"show-file-list":!1,accept:"image/*"},{default:o(()=>[n.image?(C(),S("div",fe,[m("img",{src:B(n.image),alt:"preview"},null,8,_e),e[13]||(e[13]=m("div",{class:"image-overlay"},[m("span",null,"点击替换图片")],-1))])):(C(),le(f,{key:1,type:"primary"},{default:o(()=>[...e[14]||(e[14]=[r("点击上传",-1)])]),_:1}))]),_:1},8,["action","headers"])]),_:1}),a(y,{label:"照片描述"},{default:o(()=>[a(d,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=l=>n.description=l),type:"textarea",rows:4,placeholder:"请输入照片描述"},null,8,["modelValue"])]),_:1}),a(y,{label:"排序"},{default:o(()=>[a(Q,{modelValue:n.sort,"onUpdate:modelValue":e[5]||(e[5]=l=>n.sort=l),min:0},null,8,["modelValue"])]),_:1}),a(y,{label:"状态"},{default:o(()=>[a(G,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=l=>n.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},he=Z(ge,[["__scopeId","data-v-05dfd524"]]);export{he as default};
