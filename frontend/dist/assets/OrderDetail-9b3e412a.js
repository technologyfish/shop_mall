import{_ as B,I as M,u as E,r as S,o as I,a4 as A,b as g,d as i,e as r,i as l,w as d,f as s,t as a,j as v,h as _,F as R,g as V,P as F,K as x,k as O,V as z,a5 as U}from"./index-dc0220d7.js";import{g as q,b as Q}from"./order-cd7f84b2.js";const Y={class:"order-detail-page"},j={key:0,class:"container"},H={class:"order-info card"},K={class:"info-row"},L={class:"info-row"},W={key:0,class:"countdown-text"},G={class:"info-row"},J={key:0,class:"info-row"},X={class:"shipping-info card"},Z={class:"info-row"},tt={class:"info-row"},st={class:"info-row"},et={key:0,class:"shipping-tracking"},at={class:"info-row"},nt={class:"info-row"},ot={key:0,class:"info-row"},lt={class:"items-info card"},it={class:"product-info"},rt=["src"],dt={class:"mobile-items"},ut=["src","alt"],pt={class:"item-details"},ct={class:"item-name"},_t={class:"item-info-row"},vt={class:"value"},mt={class:"item-info-row"},ft={class:"value"},gt={class:"item-info-row total"},yt={class:"value"},wt={class:"order-total"},ht={class:"total-row"},bt={key:0,class:"total-row"},kt={key:1,class:"total-row discount"},St={class:"discount-amount"},xt={class:"total-row final"},Ot={class:"amount"},Dt={key:0,class:"actions"},Tt=6e4,Ct={__name:"OrderDetail",setup(Pt){const D=M(),h=E(),e=S(null),m=S("");let y=null;const b=()=>{if(!e.value||e.value.status!==0){m.value="";return}let n=e.value.created_at;typeof n=="string"&&(n=n.replace(" ","T"));const t=new Date(n).getTime(),u=Date.now(),p=t+Tt-u;if(p<=0)m.value="Expired";else{const f=Math.floor(p/6e4),c=Math.floor(p%(1e3*60)/1e3);m.value=`${f}m ${c}s`}};I(async()=>{const n=await q(D.params.id);e.value=n.data.data,b(),y=setInterval(b,1e3)}),A(()=>{y&&clearInterval(y)});const T=()=>{h.push("/user-center/orders")},C=n=>({0:"warning",1:"primary",3:"success",4:"info"})[n]||"info",P=n=>({0:"Pending",1:"Processing",3:"Completed",4:"Cancelled"})[n]||"Unknown",N=n=>{if(!n)return"";const t=new Date(n),u=t.getFullYear(),p=String(t.getMonth()+1).padStart(2,"0"),f=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),w=String(t.getMinutes()).padStart(2,"0");return`${u}/${p}/${f} ${c}:${w}`},k=n=>{var u;const t=((u=n.product)==null?void 0:u.image)||n.product_image;return t?t.startsWith("http")?t:`https://www.aizhong168.cn${t}`:"https://via.placeholder.com/60"},$=async()=>{try{await F.confirm("Are you sure you want to cancel this order?","Confirm",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}),await Q(e.value.id),x.success("Order cancelled"),h.push("/user-center/orders")}catch(n){n!=="cancel"&&x.error(n.message||"Operation failed")}};return(n,t)=>{const u=g("el-icon"),p=g("el-button"),f=g("el-tag"),c=g("el-table-column"),w=g("el-table");return i(),r("div",Y,[e.value?(i(),r("div",j,[l(p,{class:"back-btn-mobile",onClick:T,type:"primary",plain:""},{default:d(()=>[l(u,null,{default:d(()=>[l(O(z))]),_:1}),t[0]||(t[0]=v(" Back to Orders ",-1))]),_:1}),t[22]||(t[22]=s("h1",{class:"page-title"},"Order Details",-1)),s("div",H,[s("div",K,[t[1]||(t[1]=s("span",{class:"label"},"Order No.:",-1)),s("span",null,a(e.value.order_no),1)]),s("div",L,[t[2]||(t[2]=s("span",{class:"label"},"Status:",-1)),l(f,{type:C(e.value.status)},{default:d(()=>[v(a(P(e.value.status)),1)]),_:1},8,["type"]),e.value.status===0?(i(),r("span",W,[l(u,null,{default:d(()=>[l(O(U))]),_:1}),v(" "+a(m.value==="Expired"?"Expired":m.value),1)])):_("",!0)]),s("div",G,[t[3]||(t[3]=s("span",{class:"label"},"Order Time:",-1)),s("span",null,a(e.value.created_at),1)]),e.value.pay_time?(i(),r("div",J,[t[4]||(t[4]=s("span",{class:"label"},"Paid At:",-1)),s("span",null,a(e.value.pay_time),1)])):_("",!0)]),s("div",X,[t[12]||(t[12]=s("h3",{class:"page-title"},"Shipping Information",-1)),s("div",Z,[t[5]||(t[5]=s("span",{class:"label"},"Recipient:",-1)),s("span",null,a(e.value.shipping_name),1)]),s("div",tt,[t[6]||(t[6]=s("span",{class:"label"},"Phone:",-1)),s("span",null,a(e.value.shipping_phone),1)]),s("div",st,[t[7]||(t[7]=s("span",{class:"label"},"Address:",-1)),s("span",null,a(e.value.shipping_address),1)]),e.value.status===3&&(e.value.shipping_company||e.value.shipping_no)?(i(),r("div",et,[t[11]||(t[11]=s("div",{class:"divider"},null,-1)),s("div",at,[t[8]||(t[8]=s("span",{class:"label"},"Carrier:",-1)),s("span",null,a(e.value.shipping_company||"N/A"),1)]),s("div",nt,[t[9]||(t[9]=s("span",{class:"label"},"Tracking No.:",-1)),s("span",null,a(e.value.shipping_no||"N/A"),1)]),e.value.shipped_at?(i(),r("div",ot,[t[10]||(t[10]=s("span",{class:"label"},"Shipped At:",-1)),s("span",null,a(N(e.value.shipped_at)),1)])):_("",!0)])):_("",!0)]),s("div",lt,[t[19]||(t[19]=s("h3",{class:"page-title"},"Products",-1)),l(w,{data:e.value.items,class:"pc-table"},{default:d(()=>[l(c,{label:"Product"},{default:d(({row:o})=>[s("div",it,[s("img",{src:k(o)},null,8,rt),s("span",null,a(o.product_name),1)])]),_:1}),l(c,{prop:"price",label:"Price",width:"120"},{default:d(({row:o})=>[v("£"+a(o.price),1)]),_:1}),l(c,{prop:"quantity",label:"Qty",width:"100"}),l(c,{label:"Subtotal",width:"120"},{default:d(({row:o})=>[v("£"+a(o.total_amount),1)]),_:1})]),_:1},8,["data"]),s("div",dt,[(i(!0),r(R,null,V(e.value.items,o=>(i(),r("div",{key:o.id,class:"item-card"},[s("img",{src:k(o),alt:o.product_name,class:"item-image"},null,8,ut),s("div",pt,[s("h4",ct,a(o.product_name),1),s("div",_t,[t[13]||(t[13]=s("span",{class:"label"},"Price:",-1)),s("span",vt,"£"+a(o.price),1)]),s("div",mt,[t[14]||(t[14]=s("span",{class:"label"},"Qty:",-1)),s("span",ft,a(o.quantity),1)]),s("div",gt,[t[15]||(t[15]=s("span",{class:"label"},"Subtotal:",-1)),s("span",yt,"£"+a(o.total_amount),1)])])]))),128))]),s("div",wt,[s("div",ht,[t[16]||(t[16]=s("span",null,"Subtotal:",-1)),s("span",null,"£"+a(e.value.total_amount),1)]),e.value.shipping_fee>0?(i(),r("div",bt,[t[17]||(t[17]=s("span",null,"Shipping:",-1)),s("span",null,"£"+a(e.value.shipping_fee),1)])):_("",!0),e.value.discount_amount>0?(i(),r("div",kt,[s("span",null,a(e.value.promotion_id===1?"First Order Discount:":"Discount:"),1),s("span",St,"-£"+a(e.value.discount_amount),1)])):_("",!0),s("div",xt,[t[18]||(t[18]=s("span",null,"Total:",-1)),s("span",Ot,"£"+a(e.value.pay_amount),1)])])]),e.value.status===0?(i(),r("div",Dt,[l(p,{type:"primary",size:"large"},{default:d(()=>[...t[20]||(t[20]=[v("Pay Now",-1)])]),_:1}),l(p,{size:"large",onClick:$},{default:d(()=>[...t[21]||(t[21]=[v("Cancel Order",-1)])]),_:1})])):_("",!0)])):_("",!0)])}}},Bt=B(Ct,[["__scopeId","data-v-614bd4d6"]]);export{Bt as default};
