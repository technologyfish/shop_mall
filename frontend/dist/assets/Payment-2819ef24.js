import{_ as D,I as $,u as C,r as f,o as I,b as _,d as r,e as i,f as t,t as a,F as B,g as N,j as h,h as F,i as l,w as d,K as p,k as g,T,U,V as q}from"./index-dc0220d7.js";import{g as z}from"./order-cd7f84b2.js";import{c as L}from"./payment-7a4b100c.js";const M={class:"payment-page"},R={class:"container"},A={key:0,class:"payment-layout"},j={class:"order-summary"},E={class:"section-card"},K={class:"order-info"},Q={class:"info-row"},W={class:"value"},Y={class:"info-row"},G={class:"value"},H={class:"order-items"},J=["src","alt"],X={class:"item-info"},Z={class:"item-name"},tt={class:"item-meta"},et={class:"item-total"},st={class:"shipping-info"},ot={class:"amount-summary"},at={class:"amount-row"},nt={key:0,class:"amount-row"},lt={key:1,class:"amount-row"},rt={key:2,class:"amount-row discount"},it={class:"discount-price"},dt={class:"amount-row total"},ut={class:"total-price"},pt={class:"payment-section"},ct={class:"section-card"},_t={class:"payment-option"},mt={class:"payment-notice"},vt={class:"back-link"},yt={key:1,class:"loading-state"},ft={__name:"Payment",setup(ht){const w=$(),y=C(),s=f(null),c=f("bank_card"),m=f(!1),b=async()=>{try{const o=w.params.id||w.query.order_id;if(!o){p.error("Order ID not found"),y.push("/orders");return}const e=await z(o);if(s.value=e.data.data,s.value.pay_status===1){p.warning("This order has been paid"),y.push(`/order/${o}`);return}}catch{p.error("Failed to load order"),y.push("/orders")}},x=o=>o?new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",O=o=>o?o.startsWith("http")?o:`https://www.aizhong168.cn${o}`:"https://via.placeholder.com/80",P=async()=>{var o,e;if(!c.value){p.warning("Please select a payment method");return}m.value=!0;try{const v=(await L({order_no:s.value.order_no,payment_method:c.value,return_url:`${window.location.origin}/payment/result`,callback_url:"http://localhost:8000/api/payments/callback"})).data.data;v.payment_url?window.location.href=v.payment_url:p.error("Payment URL not returned")}catch(u){p.error(((e=(o=u.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to initiate payment")}finally{m.value=!1}};return I(()=>{b()}),(o,e)=>{const u=_("el-icon"),v=_("el-radio"),S=_("el-radio-group"),k=_("el-button"),V=_("el-skeleton");return r(),i("div",M,[t("div",R,[e[15]||(e[15]=t("h1",{class:"page-title"},"Payment",-1)),s.value?(r(),i("div",A,[t("div",j,[t("div",E,[e[10]||(e[10]=t("h2",null,"Order Summary",-1)),t("div",K,[t("div",Q,[e[2]||(e[2]=t("span",{class:"label"},"Order No:",-1)),t("span",W,a(s.value.order_no),1)]),t("div",Y,[e[3]||(e[3]=t("span",{class:"label"},"Order Time:",-1)),t("span",G,a(x(s.value.created_at)),1)])]),t("div",H,[e[4]||(e[4]=t("h3",null,"Order Items",-1)),(r(!0),i(B,null,N(s.value.items,n=>(r(),i("div",{key:n.id,class:"item-row"},[t("img",{src:O(n.product_image),alt:n.product_name,class:"item-img"},null,8,J),t("div",X,[t("p",Z,a(n.product_name),1),t("p",tt,"Qty: "+a(n.quantity)+" × £"+a(parseFloat(n.price).toFixed(2)),1)]),t("div",et,"£"+a((n.price*n.quantity).toFixed(2)),1)]))),128))]),t("div",st,[e[5]||(e[5]=t("h3",null,"Shipping Address",-1)),t("p",null,[t("strong",null,a(s.value.shipping_name),1),h(" "+a(s.value.shipping_phone),1)]),t("p",null,a(s.value.shipping_address),1)]),t("div",ot,[t("div",at,[e[6]||(e[6]=t("span",null,"Subtotal",-1)),t("span",null,"£"+a(parseFloat(s.value.total_amount).toFixed(2)),1)]),s.value.shipping_fee>0?(r(),i("div",nt,[e[7]||(e[7]=t("span",null,"Shipping",-1)),t("span",null,"£"+a(parseFloat(s.value.shipping_fee).toFixed(2)),1)])):s.value.total_amount>0?(r(),i("div",lt,[...e[8]||(e[8]=[t("span",null,"Shipping",-1),t("span",{style:{color:"#67c23a"}},"Free",-1)])])):F("",!0),s.value.discount_amount>0?(r(),i("div",rt,[t("span",null,a(s.value.promotion_id===1?"First Order Discount":"Discount"),1),t("span",it,"-£"+a(parseFloat(s.value.discount_amount).toFixed(2)),1)])):F("",!0),t("div",dt,[e[9]||(e[9]=t("span",null,"Total Amount",-1)),t("span",ut,"£"+a(parseFloat(s.value.pay_amount).toFixed(2)),1)])])])]),t("div",pt,[t("div",ct,[e[14]||(e[14]=t("h2",null,"Payment Method",-1)),l(S,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=n=>c.value=n),class:"payment-methods"},{default:d(()=>[l(v,{label:"bank_card",border:""},{default:d(()=>[t("div",_t,[l(u,{size:"24"},{default:d(()=>[l(g(T))]),_:1}),e[11]||(e[11]=t("div",{class:"option-info"},[t("h4",null,"Bank Card Payment"),t("p",null,"Secure payment via third-party gateway")],-1))])]),_:1})]),_:1},8,["modelValue"]),t("div",mt,[l(u,null,{default:d(()=>[l(g(U))]),_:1}),e[12]||(e[12]=t("p",null,"You will be redirected to a secure payment page to complete your transaction.",-1))]),l(k,{type:"primary",size:"large",class:"btn-pay",loading:m.value,onClick:P,disabled:!c.value},{default:d(()=>[h(a(m.value?"Processing...":`Pay £${parseFloat(s.value.pay_amount).toFixed(2)}`),1)]),_:1},8,["loading","disabled"]),t("div",vt,[l(k,{link:"",onClick:e[1]||(e[1]=n=>o.$router.push("/orders"))},{default:d(()=>[l(u,null,{default:d(()=>[l(g(q))]),_:1}),e[13]||(e[13]=h(" Back to Orders ",-1))]),_:1})])])])])):(r(),i("div",yt,[l(V,{rows:8,animated:""})]))])])}}},Ft=D(ft,[["__scopeId","data-v-4f5c48a7"]]);export{Ft as default};
