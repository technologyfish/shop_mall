import{_ as I,u as L,r as m,J as M,a4 as A,b as c,d as y,e as P,f as d,i as a,w as l,A as S,t as _,H as h,Q as n,j as p,k as D,N as j}from"./index-dc0220d7.js";const H={class:"forgot-password-page"},J={class:"container"},Q={class:"forgot-password-card"},$={key:0,class:"form-section"},G={class:"links"},K={key:1,class:"form-section"},O={class:"code-sent-info"},W={class:"email"},X={class:"links"},Y={__name:"ForgotPassword",setup(Z){const z=L(),k=m(null),V=m(null),t=m(!1),v=m(1),i=m(0);let f=null;const o=M({email:"",code:"",password:"",confirmPassword:""}),E={email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Please enter a valid email",trigger:"blur"}]},q={code:[{required:!0,message:"Please enter verification code",trigger:"blur"},{len:6,message:"Code must be 6 digits",trigger:"blur"}],password:[{required:!0,message:"Please enter new password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],confirmPassword:[{required:!0,validator:(r,e,s)=>{e===""?s(new Error("Please confirm your password")):e!==o.password?s(new Error("Passwords do not match")):s()},trigger:"blur"}]},C=async()=>{var r,e;try{await k.value.validate(),t.value=!0;const s=await h({url:"/api/auth/forgot-password/send-code",method:"post",data:{email:o.email}});n.success(s.data.message||"Verification code sent successfully"),v.value=2,x(60)}catch(s){(e=(r=s.response)==null?void 0:r.data)!=null&&e.message?n.error(s.response.data.message):n.error(s.message||"Failed to send code")}finally{t.value=!1}},R=async()=>{var r,e;try{await V.value.validate(),t.value=!0;const s=await h({url:"/api/auth/forgot-password/reset",method:"post",data:{email:o.email,code:o.code,password:o.password}});n.success(s.data.message||"Password reset successfully"),setTimeout(()=>{z.push("/login")},1500)}catch(s){(e=(r=s.response)==null?void 0:r.data)!=null&&e.message?n.error(s.response.data.message):n.error(s.message||"Failed to reset password")}finally{t.value=!1}},N=async()=>{var r,e;if(!(i.value>0)){t.value=!0;try{await h({url:"/api/auth/forgot-password/send-code",method:"post",data:{email:o.email}}),n.success("Verification code resent"),x(60)}catch(s){n.error(((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to resend code")}finally{t.value=!1}}},B=()=>{v.value=1,o.code="",o.password="",o.confirmPassword="",b()},x=r=>{i.value=r,f=setInterval(()=>{i.value--,i.value<=0&&b()},1e3)},b=()=>{f&&(clearInterval(f),f=null),i.value=0};return A(()=>{b()}),(r,e)=>{const s=c("el-input"),g=c("el-form-item"),w=c("el-button"),F=c("el-form"),U=c("router-link"),T=c("el-icon");return y(),P("div",H,[d("div",J,[d("div",Q,[e[8]||(e[8]=d("div",{class:"logo-section"},[d("h1",null,"Reset Password"),d("p",{class:"subtitle"},"Enter your email to receive a verification code")],-1)),v.value===1?(y(),P("div",$,[a(F,{model:o,rules:E,ref_key:"formRef",ref:k,onSubmit:S(C,["prevent"])},{default:l(()=>[a(g,{prop:"email"},{default:l(()=>[a(s,{modelValue:o.email,"onUpdate:modelValue":e[0]||(e[0]=u=>o.email=u),type:"email",size:"large",placeholder:"Email Address","prefix-icon":"Message",disabled:t.value},null,8,["modelValue","disabled"])]),_:1}),a(w,{type:"primary",size:"large",class:"submit-btn",loading:t.value,onClick:C,"native-type":"submit"},{default:l(()=>[p(_(t.value?"Sending...":"Send Verification Code"),1)]),_:1},8,["loading"])]),_:1},8,["model"]),d("div",G,[a(U,{to:"/login",class:"link"},{default:l(()=>[...e[4]||(e[4]=[p("Back to Login",-1)])]),_:1})])])):(y(),P("div",K,[d("div",O,[a(T,{class:"success-icon",color:"#67c23a",size:48},{default:l(()=>[a(D(j))]),_:1}),e[5]||(e[5]=d("p",null,"Verification code sent to",-1)),d("p",W,_(o.email),1)]),a(F,{model:o,rules:q,ref_key:"resetFormRef",ref:V,onSubmit:S(R,["prevent"])},{default:l(()=>[a(g,{prop:"code"},{default:l(()=>[a(s,{modelValue:o.code,"onUpdate:modelValue":e[1]||(e[1]=u=>o.code=u),size:"large",placeholder:"6-digit Verification Code","prefix-icon":"ChatDotSquare",maxlength:"6",disabled:t.value},null,8,["modelValue","disabled"])]),_:1}),a(g,{prop:"password"},{default:l(()=>[a(s,{modelValue:o.password,"onUpdate:modelValue":e[2]||(e[2]=u=>o.password=u),type:"password",size:"large",placeholder:"New Password (min 6 characters)","prefix-icon":"Lock","show-password":"",disabled:t.value},null,8,["modelValue","disabled"])]),_:1}),a(g,{prop:"confirmPassword"},{default:l(()=>[a(s,{modelValue:o.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=u=>o.confirmPassword=u),type:"password",size:"large",placeholder:"Confirm New Password","prefix-icon":"Lock","show-password":"",disabled:t.value},null,8,["modelValue","disabled"])]),_:1}),a(w,{type:"primary",size:"large",class:"submit-btn",loading:t.value,onClick:R,"native-type":"submit"},{default:l(()=>[p(_(t.value?"Resetting...":"Reset Password"),1)]),_:1},8,["loading"])]),_:1},8,["model"]),d("div",X,[a(w,{link:"",onClick:N,disabled:i.value>0},{default:l(()=>[p(_(i.value>0?`Resend in ${i.value}s`:"Resend Code"),1)]),_:1},8,["disabled"]),e[7]||(e[7]=d("span",{class:"divider"},"|",-1)),a(w,{link:"",onClick:B},{default:l(()=>[...e[6]||(e[6]=[p("Change Email",-1)])]),_:1})])]))])])])}}},oe=I(Y,[["__scopeId","data-v-b2f7a626"]]);export{oe as default};
