import{_ as q,u as J,r as v,J as D,o as Q,ai as R,Q as b,b as o,d as h,e as w,f as d,i as a,ah as W,w as n,j as p,t as r,l as k,h as x,F as G,g as H,aj as X}from"./index-dc0220d7.js";const Y={class:"admin-orders-page"},Z={class:"card"},ee={class:"filter-bar"},te={class:"order-products"},ae=["src","alt"],le={class:"product-info"},se={class:"product-name"},ne={class:"product-spec"},oe={class:"pagination"},ie={__name:"Orders",setup(de){const N=J(),C=v([]),O=v(0),i=D({keyword:"",status:null,is_subscription:null,page:1,per_page:15}),y=v(!1),V=v(!1),s=D({id:null,status:1,shipping_company:"",shipping_no:""});Q(()=>{m()});const m=async()=>{try{const l=await R(i);C.value=l.data.data.data||[],O.value=l.data.data.total||0}catch{b.error("获取订单列表失败")}},$=l=>({0:"warning",1:"primary",3:"success",4:"info"})[l]||"info",B=l=>({0:"待支付",1:"待发货",3:"已完成",4:"已取消"})[l]||"未知",F=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",P=l=>{var u;const e=((u=l.product)==null?void 0:u.image)||l.product_image;return e?e.startsWith("http")?e:`https://www.aizhong168.cn${e}`:"https://via.placeholder.com/60"},T=l=>{N.push({name:"AdminOrderDetail",params:{id:l}})},j=l=>{s.id=l.id,s.status=l.status,s.shipping_company=l.shipping_company||"",s.shipping_no=l.shipping_no||"",y.value=!0},A=async()=>{var l,e;if(!s.shipping_company||!s.shipping_no){b.warning("请填写快递公司和快递单号");return}V.value=!0;try{await X(s.id,{status:3,shipping_company:s.shipping_company,shipping_no:s.shipping_no}),b.success("操作成功"),y.value=!1,m()}catch(u){b.error(((e=(l=u.response)==null?void 0:l.data)==null?void 0:e.message)||"操作失败")}finally{V.value=!1}},E=()=>{s.id=null,s.status=1,s.shipping_company="",s.shipping_no=""};return(l,e)=>{const u=o("el-input"),g=o("el-option"),U=o("el-select"),f=o("el-button"),S=o("el-tag"),c=o("el-table-column"),I=o("el-table"),K=o("el-pagination"),z=o("el-form-item"),L=o("el-form"),M=o("el-dialog");return h(),w("div",Y,[e[12]||(e[12]=d("h1",{class:"page-title"},"订单管理",-1)),d("div",Z,[d("div",ee,[a(u,{modelValue:i.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>i.keyword=t),placeholder:"搜索订单号/收货人",style:{width:"300px"},onKeyup:W(m,["enter"])},null,8,["modelValue"]),a(U,{modelValue:i.status,"onUpdate:modelValue":e[1]||(e[1]=t=>i.status=t),placeholder:"订单状态",clearable:"",onChange:m,style:{width:"150px"}},{default:n(()=>[a(g,{label:"待支付",value:0}),a(g,{label:"待发货",value:1}),a(g,{label:"已完成",value:3}),a(g,{label:"已取消",value:4})]),_:1},8,["modelValue"]),a(U,{modelValue:i.is_subscription,"onUpdate:modelValue":e[2]||(e[2]=t=>i.is_subscription=t),placeholder:"订单类型",clearable:"",onChange:m,style:{width:"150px"}},{default:n(()=>[a(g,{label:"普通订单",value:0}),a(g,{label:"订阅订单",value:1})]),_:1},8,["modelValue"]),a(f,{type:"primary",onClick:m},{default:n(()=>[...e[8]||(e[8]=[p("搜索",-1)])]),_:1})]),a(I,{data:C.value,style:{width:"100%"}},{default:n(()=>[a(c,{label:"订单号",width:"200"},{default:n(({row:t})=>[d("div",null,r(t.order_no),1),t.is_subscription==1?(h(),k(S,{key:0,type:"warning",size:"small",style:{"margin-top":"5px"}},{default:n(()=>[...e[9]||(e[9]=[p(" 订阅订单 ",-1)])]),_:1})):x("",!0)]),_:1}),a(c,{prop:"user.username",label:"用户",width:"120"}),a(c,{label:"商品",width:"300"},{default:n(({row:t})=>[d("div",te,[(h(!0),w(G,null,H(t.items,_=>(h(),w("div",{key:_.id,class:"product-item"},[d("img",{src:P(_),alt:_.product_name,class:"product-img"},null,8,ae),d("div",le,[d("div",se,r(_.product_name),1),d("div",ne,"¥"+r(_.price)+" x "+r(_.quantity),1)])]))),128))])]),_:1}),a(c,{prop:"pay_amount",label:"订单金额",width:"120"},{default:n(({row:t})=>[p("¥"+r(t.pay_amount),1)]),_:1}),a(c,{label:"订单状态",width:"120"},{default:n(({row:t})=>[a(S,{type:$(t.status)},{default:n(()=>[p(r(B(t.status)),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"收货人",width:"150"},{default:n(({row:t})=>[p(r(t.shipping_name),1)]),_:1}),a(c,{label:"下单时间",width:"180"},{default:n(({row:t})=>[p(r(F(t.created_at)),1)]),_:1}),a(c,{label:"操作",width:"200",fixed:"right"},{default:n(({row:t})=>[a(f,{link:"",type:"primary",onClick:_=>T(t.id)},{default:n(()=>[...e[10]||(e[10]=[p("查看",-1)])]),_:1},8,["onClick"]),t.status===1||t.status===3?(h(),k(f,{key:0,link:"",type:"success",onClick:_=>j(t)},{default:n(()=>[p(r(t.status===3?"查看物流":"填写物流"),1)]),_:2},1032,["onClick"])):x("",!0)]),_:1})]),_:1},8,["data"]),d("div",oe,[a(K,{"current-page":i.page,"onUpdate:currentPage":e[3]||(e[3]=t=>i.page=t),total:O.value,"page-size":i.per_page,layout:"total, prev, pager, next",onCurrentChange:m},null,8,["current-page","total","page-size"])])]),a(M,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=t=>y.value=t),title:s.status===3?"物流信息":"填写物流信息",width:"500px",onClose:E},{footer:n(()=>[a(f,{onClick:e[6]||(e[6]=t=>y.value=!1)},{default:n(()=>[p(r(s.status===3?"关闭":"取消"),1)]),_:1}),s.status!==3?(h(),k(f,{key:0,type:"primary",onClick:A,loading:V.value},{default:n(()=>[...e[11]||(e[11]=[p("确定",-1)])]),_:1},8,["loading"])):x("",!0)]),default:n(()=>[a(L,{model:s,"label-width":"100px"},{default:n(()=>[a(z,{label:"快递公司"},{default:n(()=>[a(u,{modelValue:s.shipping_company,"onUpdate:modelValue":e[4]||(e[4]=t=>s.shipping_company=t),placeholder:"请输入快递公司",disabled:s.status===3},null,8,["modelValue","disabled"])]),_:1}),a(z,{label:"快递单号"},{default:n(()=>[a(u,{modelValue:s.shipping_no,"onUpdate:modelValue":e[5]||(e[5]=t=>s.shipping_no=t),placeholder:"请输入快递单号",disabled:s.status===3},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},re=q(ie,[["__scopeId","data-v-449a2e97"]]);export{re as default};
